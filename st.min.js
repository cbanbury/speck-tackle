!function(){function t(){return{opts:{title:"",src:[],anno:[],x:"x",y:"y",xlimits:[],ylimits:[],annoTypes:[],annoTexts:[]},raw:{gxlim:[Number.MAX_VALUE,Number.MIN_VALUE],gylim:[Number.MAX_VALUE,Number.MIN_VALUE],ids:{},series:[],minima:0,annoGroups:{}},add:function(t,s){t instanceof Array?(this.opts.src.push.apply(this.opts.src,t),this.opts.anno.push.apply(this.opts.anno,s)):(this.opts.src.push(t),this.opts.anno.push(s))},annotationColumn:function(t,s){t.toUpperCase()in i.annotation?(this.opts.annoTypes.push(t),this.opts.annoTexts.push(s)):console.log("Unknown annotation type: "+t)},remove:function(t){var s=[];if(!t&&0!==t){for(var a in this.raw.ids)s.push(a);return this.raw.ids={},this.raw.series=[],this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE],this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE],s}t instanceof Array?t.sort():t=[t];for(a in t){var e=t[a];if(isNaN(e)){for(var a in this.raw.series)if(this.raw.series[a].id===e){this.raw.series.splice(a,1),s.push(this.raw.ids[e]),delete this.raw.ids[e];break}}else if(e-a<this.raw.series.length){var i=this.raw.series.splice(e-a,1);s.push(i[0].id),delete this.raw.ids[i[0].id]}}return 0===this.raw.series.length&&(this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE],this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE]),s},id:function(t){return this.raw.series[t].id},titleat:function(t){return this.raw.series[t].title},accs:function(t){return this.raw.series[t].accs},push:function(t){var s=this,a=[];for(var e in this.opts.src)"string"!=typeof this.opts.src[e]?this.fetch(this.opts.src[e],this.opts.anno[e]):a.push(this.fetch(this.opts.src[e],this.opts.anno[e]));$.when.apply($,a).done(function(){s.opts.src=[],s.opts.anno=[],s.raw.gxlim[0]===s.raw.gxlim[1]&&(s.raw.gxlim[0]-=s.raw.gxlim[0]/100,s.raw.gxlim[1]+=s.raw.gxlim[1]/100),s.raw.gylim[0]===s.raw.gylim[1]&&(s.raw.gylim[0]-=s.raw.gylim[0]/100,s.raw.gylim[1]+=s.raw.gylim[1]/100),t()})},fetch:function(t,s){var a=this,e=null;if("string"==typeof t)e="string"==typeof s&&s?$.when($.get(t),$.get(s)).then(function(t,s){if("string"==typeof t&&(t=$.parseJSON(t)),t[0]instanceof Array)for(var e in t[0])a.seriesfetch(t[0][e],s[0][e]);else a.seriesfetch(t[0],s[0])}):$.when($.get(t)).then(function(t){if("string"==typeof t&&(t=$.parseJSON(t)),t instanceof Array){s||(s=[]);for(var e in t)a.seriesfetch(t[e],s[e])}else a.seriesfetch(t,s)});else if("string"==typeof s&&s)e=$.when($.get(s)).then(function(e){if(t instanceof Array){s||(s=[]);for(var i in t)a.seriesfetch(t[i],e[i])}else a.seriesfetch(t,e)});else if(t instanceof Array)for(var i in t)a.seriesfetch(t[i],s[i]);else a.seriesfetch(t,s);return e},reset:function(){for(var t in this.raw.series){var s=this.raw.series[t];s.size=[0,s.data.length,0]}}}}function s(t,s,a,e){var i=[];return i=2===a.length?isNaN(a[0])&&isNaN(a[1])?[s[a[0]],s[a[1]]]:"number"==typeof a[0]&&"number"==typeof a[1]?[a[0],a[1]]:e&&""!==e?d3.extent(t,function(t){return t[e]}):d3.extent(t):e&&""!==e?d3.extent(t,function(t){return t[e]}):d3.extent(t),i[0]=parseFloat(i[0]),i[1]=parseFloat(i[1]),i}function a(){return{opts:{title:"",xlabel:"",ylabel:"",xreverse:!1,yreverse:!1,legend:!1,labels:!1,margins:[80,80,80,120]},data:null,timeout:null,colors:i.util.colors(),mol2svg:i.util.mol2svg(250,250),title:function(t){return this.opts.title=t,this},xlabel:function(t){return this.opts.xlabel=t,this},ylabel:function(t){return this.opts.ylabel=t,this},xreverse:function(t){return this.opts.xreverse=t,this},yreverse:function(t){return this.opts.yreverse=t,this},legend:function(t){return this.opts.legend=t,this},labels:function(t){return this.opts.labels=t,this},margins:function(t){return this.opts.margins=t,this},render:function(t){this.target=t;var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var a=this;if(this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]).on("mousedown.zoom",function(){a.mouseDown(this)}).on("mousemove.zoom",function(){a.mouseMove(this)}).on("mouseup.zoom",function(){a.mouseUp()}).on("mouseout",function(){a.mouseOut(this)}).on("dblclick.zoom",function(){a.mouseDbl(this)}),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.scales={},this.scales.x=this.opts.xreverse?d3.scale.linear().domain([1,0]).range([0,this.width]):d3.scale.linear().domain([0,1]).range([0,this.width]),this.scales.y=this.opts.yreverse?d3.scale.linear().domain([1,0]).range([this.height,0]):d3.scale.linear().domain([0,1]).range([this.height,0]),$("#st-tooltips").length?this.tooltips=d3.select("#st-tooltips"):(this.tooltips=d3.select("body").append("div").attr("width",$(t).width()).attr("height",$(t).height()).style("pointer-events","none").attr("id","st-tooltips").style("position","absolute").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")),"function"==typeof this.behavior&&this.behavior(),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title),this.opts.labels){var e=this.canvas.append("g").attr("id","st-options");e.append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options");var i=e.append("g");i.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5).attr("r",2).style("fill","#333333").style("stroke","#333333"),i.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2).text("Labels").attr("id","st-label").style("cursor","pointer"),i.on("mousedown",function(){var t=d3.select(this);if("none"===t.style("stroke")?t.style("stroke","#333333"):t.style("stroke","none"),null!==a.data){var s=a.renderdata();a.renderlabels(s)}})}},renderAxes:function(){var t=this.opts.margins,s=d3.format(".4g"),a=d3.format(",.2g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(4).tickFormat(a).orient("left"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate(-25, 0)").call(this.yaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&this.panel.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",0-t[3]/2)},renderlabels:function(t){if(this.opts.labels){var s=this.panel.select("#st-label");if("none"===s.style("stroke")||!this.data)return void this.canvas.selectAll(".st-labels").remove();var a=[this.scales.x.invert(0),this.scales.x.invert(this.width)];a=i.util.domain(this.scales.x,a);var e,r,n=50,o=Math.ceil(this.width/n),l=Math.abs(a[1]-a[0])/(o-1),h=[],c=d3.format(".2f");this.data.raw.minima?(r=10,e=function(t,s){return t>s}):(r=-5,e=function(t,s){return s>t});for(var d=0,p=0,u=0;u<t.length;u++){var f=t[u],v=this.data.accs(u),g=f[0];d+=f.length;for(var m=1;m<f.length;m++){var x=f[m],y=g[v[0]],w=g[v[1]],p=p+w;if(e(x[v[1]],w)){var b=Math.floor((y-a[0])/l),A=h[b];A?e(A[v[1]],w)&&(h[b]=g):h[b]=g}g=x}}p/=d,this.canvas.selectAll(".st-labels").remove();var k=this.canvas.append("g").attr("class","st-labels").attr("text-anchor","middle"),O=0,z=0;for(var u in h)if(h[u]&&e(p,h[u][v[1]])){var y=h[u][v[0]],M=this.scales.x(y),F=this.scales.y(h[u][v[1]]);if(Math.abs(M-O)<20&&Math.abs(F-z)<20){O=M,z=F;continue}O=M,z=F;var N="#333333";0>F&&(F=0,N="gray"),k.append("text").attr("x",M).attr("y",F+r).style("fill",N).text(c(y))}}},rendergroups:function(){if(0!==Object.keys(this.data.raw.annoGroups).length){var t=this,s=this.canvas.select("#st-options"),a=0;null===s[0][0]?(s=this.canvas.append("g").attr("id","st-options"),s.append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options")):a=15;var e=s.append("g");e.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5+a).attr("r",2).style("fill","#333333").style("stroke","#333333"),e.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2+a).text("Groups").attr("id","st-groups").style("cursor","pointer"),e.on("mouseup",function(){var s=d3.select(this);if("none"===s.style("stroke")){s.style("stroke","#333333");var a=d3.select(t.target).append("div").attr("id","st-popup").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY+5+"px").style("opacity",.9).style("background-color","white"),e=[];for(var i in t.data.raw.annoGroups)e.push(i);a.append("ul").selectAll("li").data(e).enter().append("li").style("display","block").style("cursor","pointer").html(function(s){return t.data.raw.annoGroups[s]?"<strong>"+s+"</strong>":s}).on("mousedown",function(a){for(i in t.data.raw.annoGroups)i!=a||t.data.raw.annoGroups[a]?t.data.raw.annoGroups[i]=0:t.data.raw.annoGroups[a]=1;t.mouseDbl(),s.style("stroke","none"),$("#st-popup").remove()})}else s.style("stroke","none"),$("#st-popup").remove()})}},mouseDown:function(t){var s=d3.mouse(t),a=this.opts.margins[3],e=this.opts.margins[0];this.panel.select(".st-selection").attr("x",s[0]-a).attr("xs",s[0]-a).attr("y",s[1]-e).attr("ys",s[1]-e).attr("width",1).attr("height",1).attr("display","inline")},mouseMove:function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var a=d3.mouse(t)[0]-this.opts.margins[3],e=d3.mouse(t)[1]-this.opts.margins[0],i=parseInt(s.attr("width"),10),r=parseInt(s.attr("height"),10),n=a-parseInt(s.attr("x"),10),o=e-parseInt(s.attr("y"),10),l=parseInt(s.attr("xs"),10),h=parseInt(s.attr("ys"),10);0>n&&0>o||i>2*n&&r>2*o?(s.attr("x",a),s.attr("width",l-a),s.attr("y",e),s.attr("height",h-e)):0>n||i>2*n?(s.attr("x",a),s.attr("width",l-a),s.attr("height",o)):0>o||r>2*o?(s.attr("y",e),s.attr("height",h-e),s.attr("width",n)):(s.attr("width",n),s.attr("height",o))}},mouseUp:function(){var t=5,s=this.panel.select(".st-selection");if(parseInt(s.attr("width"))>t&&parseInt(s.attr("height"))>t){var a=parseFloat(s.attr("x")),e=parseFloat(s.attr("y")),i=parseFloat(s.attr("width")),r=parseFloat(s.attr("height"));if(i=this.scales.x.invert(a+i),r=this.scales.y.invert(e+r),a=this.scales.x.invert(a),e=this.scales.y.invert(e),this.data){var n=this.data.raw.gylim[0];n>r&&(r=n)}if(this.scales.x.domain([a,i]).nice(),this.scales.y.domain([r,e]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata&&null!==this.data){var o=this.renderdata();this.renderlabels(o)}}else s.attr("display","none")},mouseOut:function(t){var s=this.panel.select(".st-selection"),a=d3.mouse(t)[0],e=d3.mouse(t)[1];(0>a||0>e||a>$(this.target).width()||e>$(this.target).height())&&s.attr("display","none")},mouseDbl:function(t){if(t){var s=d3.mouse(t)[0]-this.opts.margins[3],a=d3.mouse(t)[1]-this.opts.margins[0];if(0>s||s>this.width||0>a||a>this.height)return}if(null===this.data){var e=i.util.domain(this.scales.x,[0,1]),r=i.util.domain(this.scales.y,[0,1]);return this.scales.x.domain(e).nice(),this.scales.y.domain(r).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),void this.canvas.select(".st-yaxis").call(this.yaxis)}var n=i.util.domain(this.scales.x,this.data.raw.gxlim),o=i.util.domain(this.scales.y,this.data.raw.gylim);if(this.scales.x.domain(n).nice(),this.scales.y.domain(o).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata){this.data.reset();var l=this.renderdata();this.renderlabels(l)}},mouseOverAction:function(t,s,a,e){this.tooltips.style("display","inline"),this.tooltips.transition().duration(300).style("opacity",.9);var r=d3.format(".2f");this.tooltips.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("z-index","10").style("background-color","white");var n=r(s[a[0]]),o=r(s[a[1]]);d3.selectAll("#tooltips-meta").html(this.opts.xlabel+": "+n+"<br/>"+this.opts.ylabel+": "+o+"<br/>");var l=this;if(e&&""!==e&&s.annos){if(!(e in s.annos))return;var h=s.annos[e],c=d3.selectAll("#tooltips-meta").html();for(var d in h.tooltip)c+=d+": "+h.tooltip[d]+"<br/>";if(d3.selectAll("#tooltips-meta").html(c+"<br/>"),!h.tooltipmol)return;var p=i.util.spinner("#tooltips-meta");this.timeout=setTimeout(function(){var t=[];d3.selectAll("#tooltips-mol").style("display","none");for(var s in h.tooltipmol){var a="#tooltips-mol-"+s;d3.selectAll("#tooltips-mol").append("div").attr("id","tooltips-mol-"+s).style("float","left").style("height","100%").style("width","50%"),d3.selectAll(a).html("<em>"+s+"</em><br/>");var e=l.mol2svg.draw(h.tooltipmol[s],a);t.push(e)}$.when.apply($,t).done(function(){p.css("display","none"),d3.selectAll("#tooltips-mol").style("display","inline")})},500)}else d3.selectAll("#tooltips-mol").html("")},mouseOutAction:function(){clearTimeout(this.timeout),d3.selectAll("#tooltips-mol").html(""),this.tooltips.transition().duration(300).style("opacity",0),this.tooltips.style("display","none")},renderLegend:function(){this.canvas.select(".st-legend").remove();for(var t=this.canvas.append("g").attr("class","st-legend").style("cursor","pointer"),s=this.colors,a=this,e=0;e<this.data.raw.series.length;e++){var i=this.data.raw.series[e].id,r=this.data.raw.series[e].title,n=t.append("g").attr("stid",i);n.append("svg:rect").attr("x",this.width+5).attr("y",function(){return 20*e}).attr("width",10).attr("height",10).style("fill",function(){return s.get(i)}),n.append("text").attr("x",this.width+20).attr("y",function(){return 20*e+9}).text(function(){return r}),n.on("mouseover",function(){d3.select(this).style("fill","red");var t=d3.select(this).attr("stid");a.canvas.selectAll("."+t).style("stroke-width",2);for(var s in a.data.raw.ids)s!==t&&a.canvas.selectAll("."+s).style("opacity",.1)}),n.on("mouseout",function(){d3.select(this).style("fill","black");var t=d3.select(this).attr("stid");a.canvas.selectAll("."+t).style("stroke-width",1);for(var s in a.data.raw.ids)s!==t&&a.canvas.selectAll("."+s).style("opacity",1)})}},load:function(t){var s=this;this.data=t;var a=t.add;t.add=function(){a.apply(this,arguments),s.data.push(function(){s.xscale(),s.yscale(),s.canvas.select(".st-xaxis").call(s.xaxis),s.canvas.select(".st-yaxis").call(s.yaxis);var t=s.renderdata();s.renderlabels(t),s.rendergroups(),s.opts.legend&&s.renderLegend()})};var e=t.remove;t.remove=function(){var t=e.apply(this,arguments);for(var a in t)s.colors.remove(t[a]),s.canvas.selectAll("."+t[a]).remove();s.opts.legend&&s.renderLegend()}}}}function e(t){var s=d3.behavior.zoom().y(t.scales.y).center([0,t.scales.y(0)]).on("zoom",function(){if("function"==typeof t.renderdata&&null!==t.data){var s=t.renderdata();t.renderlabels(s)}});t.panel.call(s).on("mousedown.zoom",function(){t.mouseDown(this)}).on("mousemove.zoom",function(){t.mouseMove(this)}).on("mouseup.zoom",function(){t.mouseUp()}).on("mouseout",function(){t.mouseOut(this)}).on("dblclick.zoom",function(){t.mouseDbl(this)})}var i={version:"0.0.3"};i.util={},i.util.cache=function(){var t={},s=[],a=function(t){return"[object Object]"===t.toString()?$.param(t):t.toString()},e=function(a,e){-1===s.indexOf(a)&&s.push(a),t[a]=e},i=function(s){return t.hasOwnProperty(s)},r=function(s){var a;return void 0!==t[s]&&(a="[object Object]"===t[s].toString()?$.extend(!0,{},t[s]):t[s]),a},n=function(t){return a(t)};return{add:e,get:r,getKey:n,exists:i}},i.util.colors=function(){var t={0:"red",1:"blue",2:"green",3:"orange",4:"yellow",5:"black"},s={};s.size=function(){var t,s=-1;for(t in this)this.hasOwnProperty(t)&&s++;return s};var a=function(t){if(s[t])return s[t];var a=i();return s[t]=a,s[t]},e=function(t){s[t]&&delete s[t]},i=function(){var a=Object.keys(t).length,e=s.size(),i=e%a;return t[i]};return{get:a,remove:e}},i.util.hashcode=function(t){var s,a,e,i=0;if(0==t.length)return i;for(s=0,e=t.length;e>s;s++)a=t.charCodeAt(s),i=(i<<5)-i+a,i|=0;return i},i.util.domain=function(t,s){var a=t.domain();return a[0]>a[1]?[s[1],s[0]]:[s[0],s[1]]},i.util.mol2svg=function(t,s){var a=t||200,e=s||200,r=null,n=null,o=0,l=i.util.cache(),h=function(t,s){var a,e=d3.select(s),i=l.getKey(t);if(l.exists(i)){var r=l.get(i);c(r,e)}else a=$.when($.get(t)).then(function(t){l.add(i,t),c(t,e)});return a},c=function(t,s){var a=t.split(/\r\n|\n/),e=a[3].match(/\d+/g),i=parseFloat(e[0]),r=parseFloat(e[1]),n=d(a,i),l=p(a,i,r);u(a,n,i+r);var h=f(n,s);v(n,l,h),g(n,o,h)},d=function(t,s){for(var a=[],e=4,i=e;s+e>i;i++){var r=t[i].match(/-*\d+\.\d+|\w+/g);a.push({x:parseFloat(r[0]),y:parseFloat(r[1]),symbol:r[3],mass:0,charge:0})}return a},p=function(t,s,a){for(var e=[],i=4,r=s+i;s+a+i>r;r++){var n=t[r].match(/\d+/g);e.push({a1:parseInt(n[0])-1,a2:parseInt(n[1])-1,order:parseInt(n[2]),stereo:parseInt(n[3])})}return e},u=function(t,s,a){for(var e=4,i=a+e;i<t.length;i++)if(-1!==t[i].indexOf("M  ISO"))for(var r=t[i].match(/-*\d+/g),n=0,o=1;n<r[0];n++,o+=2)s[r[o]-1].mass=parseInt(r[o+1],10);else if(-1!==t[i].indexOf("M  CHG"))for(var r=t[i].match(/-*\d+/g),n=0,o=1;n<r[0];n++,o+=2)s[r[o]-1].charge=parseInt(r[o+1],10)},f=function(t,s){var i=d3.extent(t,function(t){return t.x}),o=d3.extent(t,function(t){return t.y}),l=[10,10,10,10],h=a-l[1]-l[3],c=e-l[0]-l[2],d=(i[1]-i[0])/(o[1]-o[0]);d>1?c/=d:h*=d,r=d3.scale.linear().domain([i[0],i[1]]).range([0,h]),n=d3.scale.linear().domain([o[0],o[1]]).range([c,0]);var p=s.append("svg:svg").attr("width",h+l[1]+l[3]).attr("height",c+l[0]+l[2]).append("svg:g").attr("transform","translate("+l[3]+","+l[0]+")");return p},v=function(t,s,a){for(var e=0;e<s.length;e++){var i=t[s[e].a1],l=t[s[e].a2],h=l.x-i.x,c=l.y-i.y,d=Math.sqrt(h*h+c*c),p=h/d*.2,u=c/d*.2,f=i.x+p,v=i.y+u,g=l.x-p,A=l.y-u;o+=m(r(f),n(v),r(g),n(A));var k,O,z,M=[];if(1===s[e].order)if(1===s[e].stereo){var F=m(f,v,g,A);k=.1,O=k*(A-v)/F,z=k*(f-g)/F,M=[[f,v],[g+O,A+z],[g-O,A-z]],a.append("svg:path").style("fill","none").style("stroke-width",1).attr("d",y(M))}else if(6===s[e].stereo){k=.2,O=k*(A-v)/d,z=k*(f-g)/d;for(var N=g+O-f,T=A+z-v,I=g-O-f,$=A-z-v,L=.05;1>=L;L+=.15)M.push([f+N*L,v+T*L],[f+I*L,v+$*L]);a.append("svg:path").style("fill","none").style("stroke-width",1).attr("d",w(M)).attr("stroke","black")}else if(4===s[e].stereo){k=.2,O=k*(A-v)/d,z=k*(f-g)/d;for(var N=g+O-f,T=A+z-v,I=g-O-f,$=A-z-v,L=.05;1>=L;L+=.1)M.push(M.length%2===0?[f+N*L,v+T*L]:[f+I*L,v+$*L]);a.append("svg:path").attr("d",b(M)).attr("fill","none").style("stroke-width",1).attr("stroke","black")}else M=[[f,v],[g,A]],a.append("svg:path").attr("d",x(M)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black");else 2===s[e].order?(k=.1,O=k*(A-v)/d,z=k*(f-g)/d,M=[[f+O,v+z],[g+O,A+z],[f-O,v-z],[g-O,A-z]],a.append("svg:path").attr("d",x(M)).attr("stroke-width","1").style("fill","none").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")):3===s[e].order&&(k=.15,O=k*(A-v)/d,z=k*(f-g)/d,M=[[f,v],[g,A],[f+O,v+z],[g+O,A+z],[f-O,v-z],[g-O,A-z]],a.append("svg:path").attr("d",x(M)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black"))}o/=s.length},g=function(t,s,a){for(var e=0;e<t.length;e++){var i=t[e],o=d3.rgb(A[i.symbol]),l=a.append("svg:g").attr("transform","translate("+r(i.x)+","+n(i.y)+")");if(l.append("svg:circle").attr("r",Math.ceil(s/3)).attr("fill","white").attr("opacity","1"),l.append("text").attr("dy",Math.ceil(s/4.5)).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/1.5)).attr("fill",o).text(i.symbol),0!==i.charge){var h=i.charge;h=0>h?-1===h?"-":h+"-":1===h?"+":h+"+",l.append("text").attr("dx",1*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("fill",o).attr("font-size",Math.ceil(s/3)).text(h)}0!==i.mass&&l.append("text").attr("dx",-2*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/3)).attr("fill",o).text(i.mass)}},m=function(t,s,a,e){return Math.sqrt((a-t)*(a-t)+(e-s)*(e-s))},x=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],a=1;a<t.length;a++)s+=a%2===0?"M"+t[a][0]+","+t[a][1]:"L"+t[a][0]+","+t[a][1];return s}).x(function(t){return r(t[0])}).y(function(t){return n(t[1])}),y=d3.svg.line().x(function(t){return r(t[0])}).y(function(t){return n(t[1])}),w=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],a=1;a<t.length;a++)s+=a%2===0?"M"+t[a][0]+","+t[a][1]:"L"+t[a][0]+","+t[a][1];return s}).x(function(t){return r(t[0])}).y(function(t){return n(t[1])}),b=d3.svg.line().interpolate("cardinal").x(function(t){return r(t[0])}).y(function(t){return n(t[1])}),A={H:"#000000",He:"#FFC0CB",Li:"#B22222",B:"#00FF00",C:"#000000",N:"#8F8FFF",O:"#F00000",F:"#DAA520",Na:"#0000FF",Mg:"#228B22",Al:"#808090",Si:"#DAA520",P:"#FFA500",S:"#FFC832",Cl:"#00FF00",Ca:"#808090",Ti:"#808090",Cr:"#808090",Mn:"#808090",Fe:"#FFA500",Ni:"#A52A2A",Cu:"#A52A2A",Zn:"#A52A2A",Br:"#A52A2A",Ag:"#808090",I:"#A020F0",Ba:"#FFA500",Au:"#DAA520"};return{draw:h}},i.util.spinner=function(t){return $(".st-spinner").length?$(".st-spinner"):($(t).append('<div class="st-spinner"><div class="st-bounce1"></div><div class="st-bounce2"></div><div class="st-bounce3"></div></div>'),$(".st-spinner"))},i.annotation={TOOLTIP:"tooltip",TOOLTIP_MOL:"tooltip_mol",ANNOTATION:"annotation"},i.parser={},i.parser.jdx=function(t,s){d3.text(t,function(t){var a,e,i,r,n="##",o="END",l="XYDATA",h="(X++(Y..Y))",c="YFACTOR",d="FIRSTX",p="LASTX",u=[],f={},v=!1,g=[],m=t.split(/\r\n|\r|\n/g);for(var x in m){var y=m[x];if(0===y.indexOf(n)){if(a=y.split(/=\s(.*)/),a.length<2)continue;e=a[0].slice(2),r=a[1].split(/\$\$(.*)/)[0].trim(),e===l&&r===h?v=!0:e===o?(v&&(parseFloat(f[d])>parseFloat(f[p])&&g.reverse(),f[i]=g,u.push(f),f={},v=!1,g=[]),v=!1):f[e]=r,i=e}else if(v)for(var w=y.match(/(\+|-)*\d+\.*\d*/g),b=1;b<w.length;b++){var A=f[c]*w[b];g.push(A)}}s(u)})},i.data={},i.data.set=function(){var a=t();return a.title=function(t){return this.opts.title=t,this},a.x=function(t){return this.opts.x=t,this},a.y=function(t){return this.opts.y=t,this},a.xlimits=function(t){return a.opts.xlimits=t,this},a.ylimits=function(t){return a.opts.ylimits=t,this},a.get=function(t,s){var a=[],e=[s.invert(0),s.invert(t)];e=i.util.domain(s,e);for(var r in this.raw.series){var n=this.raw.series[r],o=[];for(var l in n.data){var h=n.x(l);h>=e[0]&&h<=e[1]&&o.push(n.data[l])}a.push(o)}return a},a.bin=function(t,s,a){var e=[],r=[s.invert(0),s.invert(t)];r=i.util.domain(s,r);var n=1,o=0;for(var l in this.raw.series){var h=this.raw.series[l].size;h[2]=Math.ceil(t/n),o<h[2]&&(o=h[2])}var c=Math.abs(r[1]-r[0])/(o-1);for(var l in this.raw.series){for(var d=this.raw.series[l],p=d.data.length,h=d.size,u=[],f=0;h[0]>0;){var v=d.x(h[0]);if(v<r[0])break;h[0]-=1}for(;h[1]<p;){var v=d.x(h[1]);if(v>r[1])break;h[1]+=1}for(var g=h[0];g<h[1];g++){var v=d.x(g);if(v<r[0])h[0]=g;else{if(v>r[1]){h[1]=g;break}var m=Math.floor((v-r[0])/c),x=u[m-f],y=d.data[g];x?a?x[d.accs[1]]<y[d.accs[1]]?u[m-f]=x:(x.annos&&!y.annos&&(y.annos=x.annos),u[m-f]=y):Math.abs(x[d.accs[1]])>Math.abs(y[d.accs[1]])?u[m-f]=x:(x.annos&&!y.annos&&(y.annos=x.annos),u[m-f]=y):(f=m-u.length,u[m-f]=y)}}f>0&&(h[2]=u.length),d.size=h,e.push(u)}return e},a.seriesfetch=function(t,e){var r=i.util.hashcode((new Date).getTime()*Math.random()+"");r="st"+r;var n=t[a.opts.title],o=[],l=[],h=[],c=this.opts.x,d=this.opts.y;if(n&&0!==n.length||(n=r),r in this.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+r);var p="";-1!==c.lastIndexOf(".")&&(p=c.substr(0,c.lastIndexOf(".")),c=c.substr(c.lastIndexOf(".")+1),d=d.substr(d.lastIndexOf(".")+1));var u=""===p?t:t[p];if(o=s(u,t,this.opts.xlimits,c),l=s(u,t,this.opts.ylimits,d),h=[0,u.length,0],e){var f=d3.bisector(function(t){return t[c]}).left,v=this.opts.annoTypes.length;for(var g in e)if(e[g].length-2===v){var m=e[g][0];m in this.raw.annoGroups||(this.raw.annoGroups[m]=0);var x=e[g][1],y=f(u,x);if(-1!==y&&x===u[y][c]){var w=u[y];w.annos||(w.annos={});var b=w.annos;m in b||(b[m]={});for(var A=b[m],k=0;v>k;k++){var O=this.opts.annoTypes[k],z=e[g][k+2];O===i.annotation.ANNOTATION?A.annotation=z:O===i.annotation.TOOLTIP?(A.tooltip||(A.tooltip={}),A.tooltip[this.opts.annoTexts[k]]=z):O===i.annotation.TOOLTIP_MOL&&""!==z&&(A.tooltipmol||(A.tooltipmol={}),A.tooltipmol[this.opts.annoTexts[k]]=z)}}}}o[0]<this.raw.gxlim[0]&&(this.raw.gxlim[0]=o[0]),l[0]<this.raw.gylim[0]&&(this.raw.gylim[0]=l[0]),o[1]>this.raw.gxlim[1]&&(this.raw.gxlim[1]=o[1]),l[1]>this.raw.gylim[1]&&(this.raw.gylim[1]=l[1]),this.raw.ids[r]=!0,this.raw.series.push({id:r,title:n,xlim:o,ylim:l,accs:[c,d],size:h,data:u,x:function(t){return this.data[t][this.accs[0]]},y:function(t){return this.data[t][this.accs[1]]}})},a},i.data.array=function(){var a=t();return a.title=function(t){return this.opts.title=t,this},a.y=function(t){return this.opts.y=t,this},a.xlimits=function(t){return this.opts.xlimits=t,this},a.ylimits=function(t){return this.opts.ylimits=t,this},a.get=function(t,s){var a=[],e=[s.invert(0),s.invert(t)];e=i.util.domain(s,e);for(var r in this.raw.series){for(var n=this.raw.series[r],o=n.data.length,l=(n.xlim[1]-n.xlim[0])/o,h=n.size,c=[];n.size[0]>0;){var d=n.size[0]*l+n.xlim[0];if(d<e[0])break;n.size[0]-=1}for(;n.size[1]<o;){var d=n.size[1]*l+n.xlim[0];if(d>e[1])break;n.size[1]+=1}for(var p=n.size[0];p<n.size[1];p++){var d=p*l+n.xlim[0];if(d<e[0])h[0]=p;else{if(d>e[1]){h[1]=p;break}var u=n.data[p],f={x:d};f[n.accs[1]]=u,c.push(f)}}n.size=h,a.push(c)}return a},a.bin=function(t,s,a){var e=[],r=[s.invert(0),s.invert(t)];r=i.util.domain(s,r);var n=1,o=0;for(var l in this.raw.series){var h=this.raw.series[l].size;h[2]=Math.ceil(t/n),o<h[2]&&(o=h[2])}var c=Math.abs(r[1]-r[0])/(o-1);for(var l in this.raw.series){for(var d=this.raw.series[l],p=d.data.length,u=(d.xlim[1]-d.xlim[0])/p,h=d.size,f=[],v=0;d.size[0]>0;){var g=d.size[0]*u+d.xlim[0];if(g<r[0])break;d.size[0]-=1}for(;d.size[1]<p;){var g=d.size[1]*u+d.xlim[0];if(g>r[1])break;d.size[1]+=1}for(var m=d.size[0];m<d.size[1];m++){var g=m*u+d.xlim[0];if(g<r[0])h[0]=m;else{if(g>r[1]){h[1]=m;break}var x=Math.floor((g-r[0])/c),y=f[x-v],w=d.data[m];if(y)if(a)if(y[d.accs[1]]<w)f[x-v]=y;else{var b={x:g};b[d.accs[1]]=w;var A=f[x-v];A.annos&&(b.annos=f[x-v].annos),f[x-v]=b}else if(Math.abs(y[d.accs[1]])>Math.abs(w))f[x-v]=y;else{var b={x:g};b[d.accs[1]]=w;var A=f[x-v];A.annos&&(b.annos=A.annos),f[x-v]=b}else v=x-f.length,f[x-v]={x:g},f[x-v][d.accs[1]]=w;if(d.annos&&Object.keys(d.annos).length&&m in d.annos&&!f[x-v].annos){var k=f[x-v],O=d.annos[m],z=O[0];z in this.raw.annoGroups||(this.raw.annoGroups[z]=0),k.annos||(k.annos={});var M=k.annos;z in M||(M[z]={});for(var F=M[z],N=0;N<O.length;N++){var T=this.opts.annoTypes[N],I=O[N+2];T===i.annotation.ANNOTATION?F.annotation=I:T===i.annotation.TOOLTIP?(F.tooltip||(F.tooltip={}),F.tooltip[this.opts.annoTexts[N]]=I):T===i.annotation.TOOLTIP_MOL&&""!==I&&(F.tooltipmol||(F.tooltipmol={}),F.tooltipmol[this.opts.annoTexts[N]]=I)}f[x-v]=k}}}v>0&&(h[2]=f.length),d.size=h,e.push(f)}return e},a.seriesfetch=function(t,a){var e=i.util.hashcode((new Date).getTime()*Math.random()+"");e="st"+e;var r=t[this.opts.title],n=[],o=[],l=[],h="x",c=this.opts.y;if(r&&0!==r.length||(r=e),e in this.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+e);var d=""===c?t:t[c];n=s(d,t,this.opts.xlimits,h),o=s(d,t,this.opts.ylimits),l=[0,d.length,0];var p={};if(a){var u=this.opts.annoTypes.length;for(var f in a)if(a[f].length-2===u){var v=a[f][1];v<l[1]&&(p[v]=a[f])}}n[0]<this.raw.gxlim[0]&&(this.raw.gxlim[0]=n[0]),o[0]<this.raw.gylim[0]&&(this.raw.gylim[0]=o[0]),n[1]>this.raw.gxlim[1]&&(this.raw.gxlim[1]=n[1]),o[1]>this.raw.gylim[1]&&(this.raw.gylim[1]=o[1]),this.raw.ids[e]=!0,this.raw.series.push({id:e,title:r,xlim:n,ylim:o,accs:[h,c],size:l,annos:p,data:d,x:function(t){return t},y:function(t){return this.data[t][this.accs[1]]}})},a},i.chart={},i.chart.series=function(){var t=a();return t.xscale=function(){var t=this.data.raw.gxlim;this.opts.xreverse&&(t=[t[1],t[0]]),this.scales.x.domain(t).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var t=this,s=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var a=d3.mouse(this)[0]-t.opts.margins[3],e=t.scales.x.invert(a),i=t.scales.x.domain();if(t.opts.xreverse)var r=function(){return e<i[0]&&e>=i[1]};else var r=function(){return e>=i[0]&&e<i[1]};if(r()){t.xpointer.text("x = "+s(e));for(var n=0;n<t.plotted.length;n++){var o=t.data.accs(n),l=d3.bisector(function(t){return t[o[0]]}).left,h=l(t.plotted[n],e);h>t.plotted[n].length-1&&(h=t.plotted[n].length-1);var c=t.plotted[n][h];if(c){var d=t.scales.y(c[o[1]]);0>d?d=0:d>t.height&&(d=t.height),t.canvas.select("."+t.data.id(n)+"focus").attr("display","inline").attr("transform","translate("+t.scales.x(c[o[0]])+","+d+")")}}}else{t.xpointer.text("");for(var n=0;n<t.plotted.length;n++)t.canvas.select("."+t.data.id(n)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x);this.plotted=t;for(var s=this,a=0;a<t.length;a++){var e=t[a],i=this.data.id(a),r=this.data.accs(a),n=this.colors.get(i),o=d3.svg.line().interpolate("cardinal-open").x(function(t){return s.scales.x(t[r[0]])}).y(function(t){return s.scales.y(t[r[1]])});this.canvas.selectAll("."+i).remove();var l=this.canvas.append("g").attr("class",i);l.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",n).style("fill","none").style("stroke-width",1).attr("d",o(e)),l.append("svg:circle").attr("class",i+"focus").style("stroke",n).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),l.selectAll("."+i+".circle").data(e).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",n).style("stroke",n).attr("opacity",0).attr("r",3).attr("cx",function(t){return s.scales.x(t[r[0]])}).attr("cy",function(t){return s.scales.y(t[r[1]])}).on("mouseover",function(t){d3.select(this).attr("opacity",.8),s.mouseOverAction(this,t,r)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),s.mouseOutAction()})}return t},t},i.chart.ms=function(){var t=a();return t.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x),s="";for(var a in this.data.raw.annoGroups)if(this.data.raw.annoGroups[a]){s=a;break}for(var e=this,i=0;i<t.length;i++){var r=t[i],n=this.data.id(i),o=this.data.accs(i),l=e.colors.get(n);this.canvas.selectAll("."+n).remove();var h=this.canvas.append("g").attr("class",n);h.selectAll("."+n+".line").data(r).enter().append("svg:line").attr("clip-path","url(#clip-"+this.target+")").attr("x1",function(t){return e.scales.x(t[o[0]])}).attr("y1",function(t){return e.scales.y(t[o[1]])
}).attr("x2",function(t){return e.scales.x(t[o[0]])}).attr("y2",e.scales.y(0)).style("stroke",l).each(function(t){if(t.annos){if(!(s in t.annos))return;h.append("text").attr("class",n+".anno").attr("x",e.scales.x(t[o[0]])).attr("y",e.scales.y(t[o[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",l).text(t.annos[s].annotation)}}).on("mouseover",function(t){d3.select(this).attr("stroke-width",2),e.mouseOverAction(this,t,o,s)}).on("mouseout",function(){d3.select(this).attr("stroke-width",null),e.mouseOutAction()})}return this.canvas.selectAll(".zeroline").remove(),this.data.raw.gylim[0]<0&&this.canvas.append("svg:line").attr("class","zeroline").attr("clip-path","url(#clip-"+this.target+")").attr("x1",this.scales.x(this.data.raw.gxlim[0])).attr("y1",this.scales.y(0)).attr("x2",this.scales.x(this.data.raw.gxlim[1])).attr("y2",this.scales.y(0)).style("stroke","#333333"),t},t},i.chart.ir=function(){var t=a();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var t=this,s=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var a=d3.mouse(this)[0]-t.opts.margins[3],e=t.scales.x.invert(a),i=t.scales.x.domain();if(e<i[0]&&e>=i[1]){t.xpointer.text("x = "+s(e));for(var r=0;r<t.plotted.length;r++){var n=t.data.accs(r),o=d3.bisector(function(t){return t[n[0]]}).left,l=o(t.plotted[r],e);l>t.plotted[r].length-1&&(l=t.plotted[r].length-1);var h=t.plotted[r][l];if(h){var c=t.scales.y(h[n[1]]);0>c?c=0:c>t.height&&(c=t.height),t.canvas.select("."+t.data.id(r)+"focus").attr("display","inline").attr("transform","translate("+t.scales.x(h[n[0]])+","+c+")")}}}else{t.xpointer.text("");for(var r=0;r<t.plotted.length;r++)t.canvas.select("."+t.data.id(r)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x,!0),s="";for(var a in this.data.raw.annoGroups)if(this.data.raw.annoGroups[a]){s=a;break}this.data.raw.minima=1,this.plotted=t;for(var e=this,i=0;i<t.length;i++){var r=t[i],n=this.data.id(i),o=this.data.accs(i),l=this.colors.get(n),h=d3.svg.line().interpolate("cardinal-open").x(function(t){return e.scales.x(t[o[0]])}).y(function(t){return e.scales.y(t[o[1]])});this.canvas.selectAll("."+n).remove();var c=this.canvas.append("g").attr("class",n);c.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",l).style("fill","none").attr("d",h(r)),c.append("svg:circle").attr("class",n+"focus").style("stroke",l).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),c.selectAll("."+n+".circle").data(r).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",l).style("stroke",l).attr("opacity",0).attr("r",3).attr("cx",function(t){return e.scales.x(t[o[0]])}).attr("cy",function(t){return e.scales.y(t[o[1]])}).each(function(t){if(t.annos){if(!(s in t.annos))return;c.append("text").attr("class",n+".anno").attr("x",e.scales.x(t[o[0]])).attr("y",e.scales.y(t[o[1]])+20).attr("text-anchor","middle").attr("font-size","small").attr("fill",l).text(t.annos[s].annotation)}}).on("mouseover",function(t){d3.select(this).attr("opacity",.8),e.mouseOverAction(this,t,o,s)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),e.mouseOutAction()})}return t},t},i.chart.nmr=function(){var t=a();return t.render=function(t){this.target=t;var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var a=this;if(this.scales={x:d3.scale.linear().domain([1,0]).range([0,this.width]),y:d3.scale.linear().range([this.height,0])},this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]),e(a),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title),this.opts.labels){var i=this.canvas.append("g").attr("id","st-options");i.append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options");var r=i.append("g");r.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5).attr("r",2).style("fill","#333333").style("stroke","#333333"),r.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2).text("Labels").attr("id","st-label").style("cursor","pointer"),r.on("mousedown",function(){var t=d3.select(this);if("none"===t.style("stroke")?t.style("stroke","#333333"):t.style("stroke","none"),null!==a.data){var s=a.renderdata();a.renderlabels(s)}})}return"function"==typeof this.behavior&&this.behavior(),this},t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2)},t.mouseDown=function(t){var s=d3.mouse(t),a=this.opts.margins[3];this.panel.select(".st-selection").attr("x",s[0]-a).attr("xs",s[0]-a).attr("width",1).attr("height",this.height).attr("display","inline")},t.mouseMove=function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var a=d3.mouse(t)[0]-this.opts.margins[3],e=parseInt(s.attr("width"),10),i=a-parseInt(s.attr("x"),10),r=parseInt(s.attr("xs"),10);1>i&&e>2*i?(s.attr("x",a),s.attr("width",r-a)):s.attr("width",i)}},t.mouseUp=function(){var t=5,s=this.panel.select(".st-selection");if(parseInt(s.attr("width"))>t){var a=parseFloat(s.attr("x")),e=parseFloat(s.attr("width"));if(e=this.scales.x.invert(a+e),a=this.scales.x.invert(a),this.scales.x.domain([a,e]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),"function"==typeof this.renderdata&&null!==this.data){var i=this.renderdata();this.renderlabels(i)}}else s.attr("display","none")},t.mouseDbl=function(t){if(t){var s=d3.mouse(t)[0]-this.opts.margins[3],a=d3.mouse(t)[1]-this.opts.margins[0];if(0>s||s>this.width||0>a||a>this.height)return}if(null===this.data)return this.scales.x.domain([1,0]).nice(),this.scales.y.domain([0,1]).nice(),void this.canvas.select(".st-xaxis").call(this.xaxis);if(this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice(),this.scales.y.domain(this.data.raw.gylim),this.canvas.select(".st-xaxis").call(this.xaxis),"function"==typeof this.renderdata){this.data.reset();var e=this.renderdata();this.renderlabels(e)}},t.load=function(t){var s=this;this.data=t;var a=t.add;t.add=function(){a.apply(this,arguments),s.data.push(function(){s.xscale(),s.yscale(),e(s),s.canvas.select(".st-xaxis").call(s.xaxis);var t=s.renderdata();s.renderlabels(t),s.rendergroups(),s.opts.legend&&s.renderLegend()})};var i=t.remove;t.remove=function(){var t=i.apply(this,arguments);for(var a in t)s.colors.remove(t[a]),s.canvas.selectAll("."+t[a]).remove();s.opts.legend&&s.renderLegend()}},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x),s="";for(var a in this.data.raw.annoGroups)if(this.data.raw.annoGroups[a]){s=a;break}for(var e=this,i=0;i<t.length;i++){var r=t[i],n=this.data.id(i),o=this.data.accs(i),l=d3.svg.line().x(function(t){return e.scales.x(t[o[0]])}).y(function(t){return e.scales.y(t[o[1]])});this.canvas.selectAll("."+n).remove();var h=this.canvas.append("g").attr("class",n);h.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(n)).style("fill","none").style("stroke-width",1).attr("d",l(r)),h.data(r).each(function(t){if(t.annos){if(!(s in t.annos))return;h.append("text").attr("class",n+".anno").attr("x",e.scales.x(t[o[0]])).attr("y",e.scales.y(t[o[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",color).text(t.annos[s].annotation)}})}return t},t},i.chart.nmr2d=function(){var t=a();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain([this.data.raw.gylim[1],this.data.raw.gylim[0]]).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.scales.y.domain([1,0]);var t=this.canvas.append("svg:rect").attr("class","st-selection").attr("y",0).attr("width",1).attr("height",this.height).style("pointer-events","none").attr("visibility","hidden"),s=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("width",this.width).attr("height",1).style("pointer-events","none").attr("visibility","hidden"),a=this;d3.select(".st-base").on("mousemove",function(){var e=d3.mouse(this)[0]-a.opts.margins[3],i=d3.mouse(this)[1]-a.opts.margins[0];0>e||e>a.width||0>i||i>a.height?(t.attr("visibility","hidden"),s.attr("visibility","hidden")):(t.attr("x",e),s.attr("y",i),t.attr("visibility","visible"),s.attr("visibility","visible"))}).append("svg:rect").attr("class","st-mouse-capture").style("visibility","hidden").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".3g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).tickSize(-this.height).tickPadding(5).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(6).tickFormat(s).tickSize(-this.width).tickPadding(5).orient("right"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate("+this.width+",0)").call(this.yaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",t[1]/2)},t.renderdata=function(){for(var t=this.data.get(this.width,this.scales.x),s=this,a=0;a<t.length;a++){var e=t[a],i=this.data.id(a),r=this.data.accs(a);this.canvas.selectAll("."+i).remove();var n=this.canvas.append("g").attr("class",i);n.selectAll("."+i+".circle").data(e).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(i)).style("stroke",this.colors.get(i)).attr("r",3).attr("cx",function(t){return s.scales.x(t[r[0]])}).attr("cy",function(t){return s.scales.y(t[r[1]])}).on("mouseover",function(t){s.mouseOverAction(this,t,r)}).on("mouseout",function(){s.mouseOutAction()})}},t},"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports?module.exports=i:this.st=i}();