!function(){function t(){return{opts:{title:"",src:[],x:"x",y:"y",xlimits:[],ylimits:[]},raw:{gxlim:[Number.MAX_VALUE,Number.MIN_VALUE],gylim:[Number.MAX_VALUE,Number.MIN_VALUE],ids:{},series:[]},add:function(t){t instanceof Array?this.opts.src.push.apply(this.opts.src,t):this.opts.src.push(t)},remove:function(t){var s=[];if(t instanceof Array);else if(isNaN(t)){for(var e in this.raw.series)if(this.raw.series[e].id===t){this.raw.series.splice(e,1),s.push(this.raw.ids[t]),delete this.raw.ids[t];break}}else if(t<this.raw.series.length){var i=this.raw.series.splice(t,1);s.push(i[0].id),delete this.raw.ids[i[0].id]}return 0===this.raw.series.length&&(this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE],this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE]),s},id:function(t){return this.raw.series[t].id},titleat:function(t){return this.raw.series[t].title},accs:function(t){return this.raw.series[t].accs},annotation:function(t){t===n.annotation.ANNOTATION||t===n.annotation.TOOLTIP||console.log("Unknown annotation type: "+t)},push:function(t){var s=this,e=[];for(var i in this.opts.src)"string"!=typeof this.opts.src[i]?this.fetch(this.opts.src[i]):e.push(this.fetch(this.opts.src[i]));$.when.apply($,e).done(function(){s.opts.src=[],t()})},reset:function(){for(var t in this.raw.series){var s=this.raw.series[t];s.size=[0,s.data.length,0]}}}}function s(t,s,e,i){var a=[];return a=2===e.length?isNaN(e[0])&&isNaN(e[1])?[s[e[0]],s[e[1]]]:"number"==typeof e[0]&&"number"==typeof e[1]?[e[0],e[1]]:d3.extent(t,function(t){return t[i]}):d3.extent(t,function(t){return t[i]}),a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a}function e(t,e){var i=n.util.hashcode((new Date).getTime()*Math.random()+"");i="st"+i;var a=t[e.opts.title],r=[],o=[],l=[],h=e.opts.x,c=e.opts.y;if(a&&0!==a.length||(a=i),i in e.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+i);var d="";-1!==h.lastIndexOf(".")&&(d=h.substr(0,h.lastIndexOf(".")),h=h.substr(h.lastIndexOf(".")+1),c=c.substr(c.lastIndexOf(".")+1));var p=""===d?t:t[d];r=s(p,t,e.opts.xlimits,h),o=s(p,t,e.opts.ylimits,c),l=[0,p.length,0],r[0]<e.raw.gxlim[0]&&(e.raw.gxlim[0]=r[0]),o[0]<e.raw.gylim[0]&&(e.raw.gylim[0]=o[0]),r[1]>e.raw.gxlim[1]&&(e.raw.gxlim[1]=r[1]),o[1]>e.raw.gylim[1]&&(e.raw.gylim[1]=o[1]),e.raw.ids[i]=!0,e.raw.series.push({id:i,title:a,xlim:r,ylim:o,accs:[h,c],size:l,data:p,x:function(t){return this.data[t][this.accs[0]]},y:function(t){return this.data[t][this.accs[1]]}})}function i(t,e){var i=n.util.hashcode((new Date).getTime()*Math.random()+"");i="st"+i;var a=t[e.opts.title],r=[],o=[],l=[],h="x",c=e.opts.y;if(a&&0!==a.length||(a=i),i in e.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+i);var d=""===c?t:t[c];r=s(d,t,e.opts.xlimits,h),o=s(d,t,e.opts.ylimits,c),l=[0,d.length,0],r[0]<e.raw.gxlim[0]&&(e.raw.gxlim[0]=r[0]),o[0]<e.raw.gylim[0]&&(e.raw.gylim[0]=o[0]),r[1]>e.raw.gxlim[1]&&(e.raw.gxlim[1]=r[1]),o[1]>e.raw.gylim[1]&&(e.raw.gylim[1]=o[1]),e.raw.ids[i]=!0,e.raw.series.push({id:i,title:a,xlim:r,ylim:o,accs:[h,c],size:l,data:d,x:function(t){return t},y:function(t){return this.data[t][this.accs[1]]}})}function a(){return{opts:{title:"",xlabel:"",ylabel:"",xreverse:!1,yreverse:!1,legend:!1,margins:[80,80,80,120]},data:null,colors:n.util.colors(),title:function(t){return this.opts.title=t,this},xlabel:function(t){return this.opts.xlabel=t,this},ylabel:function(t){return this.opts.ylabel=t,this},xreverse:function(t){return this.opts.xreverse=t,this},yreverse:function(t){return this.opts.yreverse=t,this},legend:function(t){return this.opts.legend=t,this},margins:function(t){return this.opts.margins=t,this},render:function(t){this.target=t;var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var e=this;this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]).on("mousedown.zoom",function(){e.mouseDown(this)}).on("mousemove.zoom",function(){e.mouseMove(this)}).on("mouseup.zoom",function(){e.mouseUp()}).on("mouseout",function(){e.mouseOut(this)}).on("dblclick.zoom",function(){e.mouseDbl()}),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.scales={},this.scales.x=this.opts.xreverse?d3.scale.linear().domain([1,0]).range([0,this.width]):d3.scale.linear().domain([0,1]).range([0,this.width]),this.scales.y=this.opts.yreverse?d3.scale.linear().domain([1,0]).range([this.height,0]):d3.scale.linear().domain([0,1]).range([this.height,0]),"function"==typeof this.behavior&&this.behavior(),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title)},renderAxes:function(){var t=this.opts.margins,s=d3.format(".4g"),e=d3.format(",.2g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(4).tickFormat(e).orient("left"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate(-25, 0)").call(this.yaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&this.panel.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",0-t[3]/2)},mouseDown:function(t){var s=d3.mouse(t),e=this.opts.margins[3],i=this.opts.margins[0];this.panel.select(".st-selection").attr("x",s[0]-e).attr("xs",s[0]-e).attr("y",s[1]-i).attr("ys",s[1]-i).attr("width",1).attr("height",1).attr("display","inline")},mouseMove:function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var e=d3.mouse(t)[0]-this.opts.margins[3],i=d3.mouse(t)[1]-this.opts.margins[0],a=parseInt(s.attr("width"),10),r=parseInt(s.attr("height"),10),n=e-parseInt(s.attr("x"),10),o=i-parseInt(s.attr("y"),10),l=parseInt(s.attr("xs"),10),h=parseInt(s.attr("ys"),10);0>n&&0>o||a>2*n&&r>2*o?(s.attr("x",e),s.attr("width",l-e),s.attr("y",i),s.attr("height",h-i)):0>n||a>2*n?(s.attr("x",e),s.attr("width",l-e),s.attr("height",o)):0>o||r>2*o?(s.attr("y",i),s.attr("height",h-i),s.attr("width",n)):(s.attr("width",n),s.attr("height",o))}},mouseUp:function(){var t=5,s=this.panel.select(".st-selection");if(parseInt(s.attr("width"))>t&&parseInt(s.attr("height"))>t){var e=parseFloat(s.attr("x")),i=parseFloat(s.attr("y")),a=parseFloat(s.attr("width")),r=parseFloat(s.attr("height"));a=this.scales.x.invert(e+a),r=this.scales.y.invert(i+r),e=this.scales.x.invert(e),i=this.scales.y.invert(i),0>r&&(r=0),this.scales.x.domain([e,a]).nice(),this.scales.y.domain([r,i]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata&&null!==this.data&&this.renderdata()}else s.attr("display","none")},mouseOut:function(t){var s=this.panel.select(".st-selection"),e=d3.mouse(t)[0],i=d3.mouse(t)[1];(0>e||0>i||e>$(this.target).width()||i>$(this.target).height())&&s.attr("display","none")},mouseDbl:function(){if(null===this.data){var t=n.util.domain(this.scales.x,[0,1]),s=n.util.domain(this.scales.y,[0,1]);return this.scales.x.domain(t).nice(),this.scales.y.domain(s).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),void this.canvas.select(".st-yaxis").call(this.yaxis)}var e=n.util.domain(this.scales.x,this.data.raw.gxlim),i=n.util.domain(this.scales.y,this.data.raw.gylim);this.scales.x.domain(e).nice(),this.scales.y.domain(i).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata&&(this.data.reset(),this.renderdata())},renderLegend:function(){$(".st-legend").empty();for(var t=this.canvas.append("g").attr("class","st-legend").style("cursor","pointer"),s=this.colors,e=this,i=0;i<this.data.raw.series.length;i++){var a=this.data.raw.series[i].id,r=this.data.raw.series[i].title,n=t.append("g").attr("stid",a);n.append("svg:rect").attr("x",this.width+5).attr("y",function(){return 20*i}).attr("width",10).attr("height",10).style("fill",function(){return s.get(a)}),n.append("text").attr("x",this.width+20).attr("y",function(){return 20*i+9}).text(function(){var t=r;return t}),n.on("mouseover",function(){d3.select(this).style("fill","red");var t=d3.select(this).attr("stid");e.canvas.selectAll("."+t).style("stroke-width",2);for(var s in e.data.raw.ids)s!==t&&e.canvas.selectAll("."+s).style("opacity",.1)}),n.on("mouseout",function(){d3.select(this).style("fill","black");var t=d3.select(this).attr("stid");e.canvas.selectAll("."+t).style("stroke-width",1);for(var s in e.data.raw.ids)s!==t&&e.canvas.selectAll("."+s).style("opacity",1)})}},load:function(t){var s=this;this.data=t;var e=t.add;t.add=function(){e.apply(this,arguments),s.data.push(function(){s.xscale(),s.yscale(),s.canvas.select(".st-xaxis").call(s.xaxis),s.canvas.select(".st-yaxis").call(s.yaxis),s.renderdata(),s.opts.legend&&s.renderLegend()})};var i=t.remove;t.remove=function(){var t=i.apply(this,arguments);for(var e in t)s.colors.remove(t[e]),s.canvas.selectAll("."+t[e]).remove();s.opts.legend&&s.renderLegend()}}}}function r(t){var s=d3.behavior.zoom().y(t.scales.y).center([0,t.scales.y(0)]).on("zoom",function(){"function"==typeof this.renderdata&&null!==this.data&&t.renderdata()});t.panel.call(s).on("mousedown.zoom",function(){t.mouseDown(this)}).on("mousemove.zoom",function(){t.mouseMove(this)}).on("mouseup.zoom",function(){t.mouseUp(this)}).on("dblclick.zoom",function(){t.mouseDbl()})}var n={version:"0.0.1"};n.util={},n.util.cache=function(){var t={},s=[],e=function(t){return"[object Object]"===t.toString()?$.param(t):t.toString()},i=function(e,i){-1===s.indexOf(e)&&s.push(e),t[e]=i},a=function(s){return t.hasOwnProperty(s)},r=function(s){var e;return void 0!==t[s]&&(e="[object Object]"===t[s].toString()?$.extend(!0,{},t[s]):t[s]),e},n=function(t){return e(t)};return{add:i,get:r,getKey:n,exists:a}},n.util.colors=function(){var t={0:"red",1:"blue",2:"green",3:"orange",4:"yellow",5:"black"},s={};return s.size=function(){var t,s=-1;for(t in this)this.hasOwnProperty(t)&&s++;return s},get=function(t){if(s[t])return s[t];var e=next();return s[t]=e,s[t]},remove=function(t){s[t]&&delete s[t]},next=function(){var e=Object.keys(t).length,i=s.size(),a=i%e;return t[a]},{get:get,remove:remove}},n.util.hashcode=function(t){var s,e,i,a=0;if(0==t.length)return a;for(s=0,i=t.length;i>s;s++)e=t.charCodeAt(s),a=(a<<5)-a+e,a|=0;return a},n.util.domain=function(t,s){var e=t.domain();return e[0]>e[1]?[s[1],s[0]]:[s[0],s[1]]},n.util.mol2svg=function(t,s){var e=t||200,i=s||200,a=null,r=null,o=0,l=n.util.cache(),h=function(t,s){$(s).empty();var e=d3.select(s),i=l.getKey(t);if(l.exists(i)){var a=l.get(i);c(a,e)}else d3.text(t,"text/plain",function(t,s){t?console.log("Invalid molfile url error "+t):(l.add(i,s),c(s,e))})},c=function(t,s){var e=t.split(/\r\n|\n/),i=e[3].match(/\d+/g),a=parseFloat(i[0]),r=parseFloat(i[1]),n=d(e,a),l=p(e,a,r);u(e,n,a+r);var h=v(n,s);f(n,l,h),g(n,o,h)},d=function(t,s){for(var e=[],i=4,a=i;s+i>a;a++){var r=t[a].match(/-*\d+\.\d+|\w+/g);e.push({x:parseFloat(r[0]),y:parseFloat(r[1]),symbol:r[3],mass:0,charge:0})}return e},p=function(t,s,e){for(var i=[],a=4,r=s+a;s+e+a>r;r++){var n=t[r].match(/\d+/g);i.push({a1:parseInt(n[0])-1,a2:parseInt(n[1])-1,order:parseInt(n[2]),stereo:parseInt(n[3])})}return i},u=function(t,s,e){for(var i=4,a=e+i;a<t.length;a++)if(-1!==t[a].indexOf("M  ISO"))for(var r=t[a].match(/-*\d+/g),n=0,o=1;n<r[0];n++,o+=2)s[r[o]-1].mass=parseInt(r[o+1],10);else if(-1!==t[a].indexOf("M  CHG"))for(var r=t[a].match(/-*\d+/g),n=0,o=1;n<r[0];n++,o+=2)s[r[o]-1].charge=parseInt(r[o+1],10)},v=function(t,s){var n=d3.extent(t,function(t){return t.x}),o=d3.extent(t,function(t){return t.y}),l=[10,10,10,10],h=e-l[1]-l[3],c=i-l[0]-l[2],d=(n[1]-n[0])/(o[1]-o[0]);d>1?c/=d:h*=d,a=d3.scale.linear().domain([n[0],n[1]]).range([0,h]),r=d3.scale.linear().domain([o[0],o[1]]).range([c,0]);var p=s.append("svg:svg").attr("width",h+l[1]+l[3]).attr("height",c+l[0]+l[2]).append("svg:g").attr("transform","translate("+l[3]+","+l[0]+")");return p},f=function(t,s,e){for(var i=0;i<s.length;i++){var n=t[s[i].a1],l=t[s[i].a2],h=l.x-n.x,c=l.y-n.y,d=Math.sqrt(h*h+c*c),p=h/d*.2,u=c/d*.2,v=n.x+p,f=n.y+u,g=l.x-p,A=l.y-u;o+=x(a(v),r(f),a(g),r(A));var k,z,F,M=[];if(1===s[i].order)if(1===s[i].stereo){var I=x(v,f,g,A);k=.1,z=k*(A-f)/I,F=k*(v-g)/I,M=[[v,f],[g+z,A+F],[g-z,A-F]],e.append("svg:path").attr("d",y(M))}else if(6===s[i].stereo){k=.2,z=k*(A-f)/d,F=k*(v-g)/d;for(var N=g+z-v,O=A+F-f,$=g-z-v,L=A-F-f,S=.05;1>=S;S+=.15)M.push([v+N*S,f+O*S],[v+$*S,f+L*S]);e.append("svg:path").attr("d",w(M)).attr("stroke","black")}else if(4===s[i].stereo){k=.2,z=k*(A-f)/d,F=k*(v-g)/d;for(var N=g+z-v,O=A+F-f,$=g-z-v,L=A-F-f,S=.05;1>=S;S+=.1)M.push(M.length%2===0?[v+N*S,f+O*S]:[v+$*S,f+L*S]);e.append("svg:path").attr("d",b(M)).attr("fill","none").attr("stroke","black")}else M=[[v,f],[g,A]],e.append("svg:path").attr("d",m(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black");else 2===s[i].order?(k=.1,z=k*(A-f)/d,F=k*(v-g)/d,M=[[v+z,f+F],[g+z,A+F],[v-z,f-F],[g-z,A-F]],e.append("svg:path").attr("d",m(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")):3===s[i].order&&(k=.15,z=k*(A-f)/d,F=k*(v-g)/d,M=[[v,f],[g,A],[v+z,f+F],[g+z,A+F],[v-z,f-F],[g-z,A-F]],e.append("svg:path").attr("d",m(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black"))}o/=s.length},g=function(t,s,e){for(var i=0;i<t.length;i++){var n=t[i],o=d3.rgb(A[n.symbol]),l=e.append("svg:g").attr("transform","translate("+a(n.x)+","+r(n.y)+")");if(l.append("svg:circle").attr("r",Math.ceil(s/3)).attr("fill","white").attr("opacity","1"),l.append("text").attr("dy",Math.ceil(s/4.5)).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/1.5)).attr("fill",o).text(n.symbol),0!==n.charge){var h=n.charge;h=0>h?-1===h?"-":h+"-":1===h?"+":h+"+",l.append("text").attr("dx",1*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("fill",o).attr("font-size",Math.ceil(s/3)).text(h)}0!==n.mass&&l.append("text").attr("dx",-2*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/3)).attr("fill",o).text(n.mass)}},x=function(t,s,e,i){return Math.sqrt((e-t)*(e-t)+(i-s)*(i-s))},m=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],e=1;e<t.length;e++)s+=e%2===0?"M"+t[e][0]+","+t[e][1]:"L"+t[e][0]+","+t[e][1];return s}).x(function(t){return a(t[0])}).y(function(t){return r(t[1])}),y=d3.svg.line().x(function(t){return a(t[0])}).y(function(t){return r(t[1])}),w=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],e=1;e<t.length;e++)s+=e%2===0?"M"+t[e][0]+","+t[e][1]:"L"+t[e][0]+","+t[e][1];return s}).x(function(t){return a(t[0])}).y(function(t){return r(t[1])}),b=d3.svg.line().interpolate("cardinal").x(function(t){return a(t[0])}).y(function(t){return r(t[1])}),A={H:"#000000",He:"#FFC0CB",Li:"#B22222",B:"#00FF00",C:"#000000",N:"#8F8FFF",O:"#F00000",F:"#DAA520",Na:"#0000FF",Mg:"#228B22",Al:"#808090",Si:"#DAA520",P:"#FFA500",S:"#FFC832",Cl:"#00FF00",Ca:"#808090",Ti:"#808090",Cr:"#808090",Mn:"#808090",Fe:"#FFA500",Ni:"#A52A2A",Cu:"#A52A2A",Zn:"#A52A2A",Br:"#A52A2A",Ag:"#808090",I:"#A020F0",Ba:"#FFA500",Au:"#DAA520"};return{draw:h}},n.util.spinner=function(t){return $(".st-spinner").length?(console.log("SDF"),$(".st-spinner")):($(t).append('<div class="st-spinner"><div class="st-bounce1"></div><div class="st-bounce2"></div><div class="st-bounce3"></div></div>'),$(".st-spinner"))},n.annotation={TOOLTIP:"tooltip",ANNOTATION:"annotation"},n.parser={},n.parser.jdx=function(t,s){d3.text(t,function(t){var e,i,a,r,n="##",o="END",l="XYDATA",h="(X++(Y..Y))",c="YFACTOR",d="FIRSTX",p="LASTX",u=[],v={},f=!1,g=[],x=t.split(/\r\n|\r|\n/g);for(var m in x){var y=x[m];if(0===y.indexOf(n)){if(e=y.split(/=\s(.*)/),e.length<2)continue;i=e[0].slice(2),r=e[1].split(/\$\$(.*)/)[0].trim(),i===l&&r===h?f=!0:i===o?(f&&(parseFloat(v[d])>parseFloat(v[p])&&g.reverse(),v[a]=g,u.push(v),v={},f=!1,g=[]),f=!1):v[i]=r,a=i}else if(f)for(var w=y.match(/(\+|-)*\d+\.*\d*/g),b=1;b<w.length;b++){var A=v[c]*w[b];g.push(A)}}s(u)})},n.data={},n.data.set=function(){var s=t();return s.title=function(t){return this.opts.title=t,this},s.x=function(t){return this.opts.x=t,this},s.y=function(t){return this.opts.y=t,this},s.xlimits=function(t){return s.opts.xlimits=t,this},s.ylimits=function(t){return s.opts.ylimits=t,this},s.fetch=function(t){var s=this,i=null;if("string"==typeof t)i=$.getJSON(t,function(t){if(t instanceof Array)for(var i in t)e(t[i],s);else e(t,s)});else if(t instanceof Array)for(var a in t)e(t[a],s);else e(t,s);return i},s.get=function(t,s){var e=[],i=[s.invert(0),s.invert(t)];i=n.util.domain(s,i);for(var a in this.raw.series){var r=this.raw.series[a],o=[];for(var l in r.data){var h=r.x(l);h>=i[0]&&h<=i[1]&&o.push(r.data[l])}e.push(o)}return e},s.bin=function(t,s,e){var i=[],a=[s.invert(0),s.invert(t)];a=n.util.domain(s,a);var r=1;for(var o in this.raw.series){var l=this.raw.series[o],h=l.data.length,c=l.size;0===c[2]&&(c[2]=Math.ceil(t/r));for(var d=Math.abs(a[1]-a[0])/(c[2]-1),p=[],u=0;l.size[0]>0;){var v=l.x(l.size[0]);if(v<a[0])break;l.size[0]-=1}for(;l.size[1]<h;){var v=l.x(l.size[1]);if(v>a[1])break;l.size[1]+=1}for(var f=l.size[0];f<l.size[1];f++){var v=l.x(f);if(v<a[0])c[0]=f;else{if(v>a[1]){c[1]=f;break}var g=Math.floor((v-a[0])/d),x=p[g],m=l.data[f];x?p[g-u]=e?x[l.accs[1]]<m[l.accs[1]]?x:m:Math.abs(x[l.accs[1]])>Math.abs(m[l.accs[1]])?x:m:(u=g-p.length,p[g-u]=m)}}u>0&&(c[2]=p.length),l.size=c,i.push(p)}return i},s},n.data.array=function(){var s=t();return s.title=function(t){return this.opts.title=t,this},s.y=function(t){return this.opts.y=t,this},s.xlimits=function(t){return this.opts.xlimits=t,this},s.ylimits=function(t){return this.opts.ylimits=t,this},s.fetch=function(t){var s=this,e=null;return"string"==typeof t?e=$.getJSON(t,function(t){i(t,s)}):i(t,s),e},s.get=function(t,s){var e=[],i=[s.invert(0),s.invert(t)];i=n.util.domain(s,i);for(var a in this.raw.series){for(var r=this.raw.series[a],o=r.data.length,l=(r.xlim[1]-r.xlim[0])/o,h=r.size,c=[];r.size[0]>0;){var d=r.size[0]*l+r.xlim[0];if(d<i[0])break;r.size[0]-=1}for(;r.size[1]<o;){var d=r.size[1]*l+r.xlim[0];if(d>i[1])break;r.size[1]+=1}for(var p=r.size[0];p<r.size[1];p++){var d=p*l+r.xlim[0];if(d<i[0])h[0]=p;else{if(d>i[1]){h[1]=p;break}var u=r.data[p],v={x:d};v[r.accs[1]]=u,c.push(v)}}r.size=h,e.push(c)}return e},s.bin=function(t,s,e){var i=[],a=[s.invert(0),s.invert(t)];a=n.util.domain(s,a);var r=1;for(var o in this.raw.series){var l=this.raw.series[o],h=l.data.length,c=(l.xlim[1]-l.xlim[0])/h,d=l.size;0===d[2]&&(d[2]=Math.ceil(t/r));for(var p=Math.abs(a[1]-a[0])/(d[2]-1),u=[],v=0;l.size[0]>0;){var f=l.size[0]*c+l.xlim[0];if(f<a[0])break;l.size[0]-=1}for(;l.size[1]<h;){var f=l.size[1]*c+l.xlim[0];if(f>a[1])break;l.size[1]+=1}for(var g=l.size[0];g<l.size[1];g++){var f=g*c+l.xlim[0];if(f<a[0])d[0]=g;else{if(f>a[1]){d[1]=g;break}var x=Math.floor((f-a[0])/p),m=u[x],y=l.data[g];m?e?m[l.accs[1]]<y?u[x-v]=m:(u[x-v]={x:f},u[x-v][l.accs[1]]=y):Math.abs(m[l.accs[1]])>Math.abs(y)?u[x-v]=m:(u[x-v]={x:f},u[x-v][l.accs[1]]=y):(v=x-u.length,u[x-v]={x:f},u[x-v][l.accs[1]]=y)}}v>0&&(d[2]=u.length),l.size=d,i.push(u)}return i},s},n.chart={},n.chart.series=function(){var t=a();return t.xscale=function(){var t=this.data.raw.gxlim;this.opts.xreverse&&(t=[t[1],t[0]]),this.scales.x.domain(t).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.tooltips=this.panel.append("foreignObject").attr("width",$(this.target).width()).attr("height",$(this.target).height()).style("pointer-events","none").append("xhtml:div").attr("class","st-tooltips").style("position","absolute").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%"),this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var t=this,s=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var e=d3.mouse(this)[0]-t.opts.margins[3],i=t.scales.x.invert(e),a=t.scales.x.domain();if(t.opts.xreverse)var r=function(){return i<a[0]&&i>=a[1]};else var r=function(){return i>=a[0]&&i<a[1]};if(r()){t.xpointer.text("x = "+s(i));for(var n=0;n<t.plotted.length;n++){var o=t.data.accs(n),l=d3.bisector(function(t){return t[o[0]]}).left,h=l(t.plotted[n],i);h>t.plotted[n].length-1&&(h=t.plotted[n].length-1);var c=t.plotted[n][h];c&&t.canvas.select("."+t.data.id(n)+"focus").attr("display","inline").attr("transform","translate("+t.scales.x(c[o[0]])+","+t.scales.y(c[o[1]])+")")}}else{t.xpointer.text("");for(var n=0;n<t.plotted.length;n++)t.canvas.select("."+t.data.id(n)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x);this.plotted=t;for(var s=this,e=d3.format(".2f"),i=0;i<t.length;i++){var a=t[i],r=this.data.id(i),n=this.data.accs(i),o=d3.svg.line().interpolate("cardinal-open").x(function(t){return s.scales.x(t[n[0]])}).y(function(t){return s.scales.y(t[n[1]])});this.canvas.selectAll("."+r).remove();var l=this.canvas.append("g").attr("class",r);l.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(r)).attr("d",o(a)),l.append("svg:circle").attr("class",r+"focus").style("stroke",this.colors.get(r)).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),l.selectAll("."+r+".circle").data(a).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(r)).style("stroke",this.colors.get(r)).attr("opacity",0).attr("r",3).attr("cx",function(t){return s.scales.x(t[n[0]])}).attr("cy",function(t){return s.scales.y(t[n[1]])}).on("mouseover",function(t){d3.select(this).attr("opacity",.8);var i=d3.mouse(this);s.tooltips.style("display","inline"),s.tooltips.transition().duration(300).style("opacity",.9),s.tooltips.style("left",i[0]+s.opts.margins[3]+10+"px").style("top",i[1]+s.opts.margins[0]-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("background-color","white");var a=e(t[n[0]]),r=e(t[n[1]]);d3.selectAll("#tooltips-meta").html(s.opts.xlabel+": "+a+"<br/>"+s.opts.ylabel+": "+r)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),s.tooltips.transition().duration(300).style("opacity",0),s.tooltips.style("display","none")})}},t},n.chart.ms=function(){var t=a();return t.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.tooltips=this.panel.append("foreignObject").attr("width",$(this.target).width()).attr("height",$(this.target).height()).style("pointer-events","none").append("xhtml:div").attr("class","st-tooltips").style("position","absolute").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")},t.mol2svg=n.util.mol2svg(200,200),t.renderdata=function(){for(var t,s=this.data.bin(this.width,this.scales.x),e=this,i=d3.format(".2f"),a=0;a<s.length;a++){var r=s[a],o=this.data.id(a),l=this.data.accs(a);this.canvas.selectAll("."+o).remove();var h=this.canvas.append("g").attr("class",o);h.selectAll("."+o+".line").data(r).enter().append("svg:line").attr("clip-path","url(#clip-"+this.target+")").attr("x1",function(t){return e.scales.x(t[l[0]])}).attr("y1",function(t){return e.scales.y(t[l[1]])}).attr("x2",function(t){return e.scales.x(t[l[0]])}).attr("y2",this.height).style("stroke",this.colors.get(o)).on("mouseover",function(s){d3.select(this).style("stroke-width",2);var a=d3.mouse(this);e.tooltips.style("display","inline"),e.tooltips.transition().duration(300).style("opacity",.9),e.tooltips.style("left",a[0]+e.opts.margins[3]+10+"px").style("top",a[1]+e.opts.margins[0]-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("background-color","white");var r=i(s[l[0]]),o=i(s[l[1]]);if(d3.selectAll("#tooltips-meta").html(e.opts.xlabel+": "+r+"<br/>"+e.opts.ylabel+": "+o),s.ref){var h=n.util.spinner("#tooltips-mol");t=setTimeout(function(){h.css("display","none"),e.mol2svg.draw("http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/174174/SDF","#tooltips-mol")},500)}else d3.selectAll("#tooltips-mol").html("")}).on("mouseout",function(){clearTimeout(t),d3.selectAll("#tooltips-mol").html(""),d3.select(this).style("stroke-width","1"),e.tooltips.transition().duration(300).style("opacity",0),e.tooltips.style("display","none")})}},t},n.chart.ir=function(){var t=a();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.tooltips=this.panel.append("foreignObject").attr("width",$(this.target).width()).attr("height",$(this.target).height()).style("pointer-events","none").append("xhtml:div").attr("class","st-tooltips").style("position","absolute").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%"),this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var t=this,s=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var e=d3.mouse(this)[0]-t.opts.margins[3],i=t.scales.x.invert(e),a=t.scales.x.domain();if(i<a[0]&&i>=a[1]){t.xpointer.text("x = "+s(i));for(var r=0;r<t.plotted.length;r++){var n=t.data.accs(r),o=d3.bisector(function(t){return t[n[0]]}).left,l=o(t.plotted[r],i);l>t.plotted[r].length-1&&(l=t.plotted[r].length-1);var h=t.plotted[r][l];h&&t.canvas.select("."+t.data.id(r)+"focus").attr("display","inline").attr("transform","translate("+t.scales.x(h[n[0]])+","+t.scales.y(h[n[1]])+")")}}else{t.xpointer.text("");for(var r=0;r<t.plotted.length;r++)t.canvas.select("."+t.data.id(r)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x,!0);this.plotted=t;for(var s=this,e=d3.format(".2f"),i=0;i<t.length;i++){var a=t[i],r=this.data.id(i),n=this.data.accs(i),o=d3.svg.line().interpolate("cardinal-open").x(function(t){return s.scales.x(t[n[0]])}).y(function(t){return s.scales.y(t[n[1]])});this.canvas.selectAll("."+r).remove();var l=this.canvas.append("g").attr("class",r);l.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(r)).attr("d",o(a)),l.append("svg:circle").attr("class",r+"focus").style("stroke",this.colors.get(r)).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),l.selectAll("."+r+".circle").data(a).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(r)).style("stroke",this.colors.get(r)).attr("opacity",0).attr("r",3).attr("cx",function(t){return s.scales.x(t[n[0]])}).attr("cy",function(t){return s.scales.y(t[n[1]])}).on("mouseover",function(t){d3.select(this).attr("opacity",.8);var i=d3.mouse(this);s.tooltips.style("display","inline"),s.tooltips.transition().duration(300).style("opacity",.9),s.tooltips.style("left",i[0]+s.opts.margins[3]+10+"px").style("top",i[1]+s.opts.margins[0]-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("background-color","white");var a=e(t[n[0]]),r=e(t[n[1]]);d3.selectAll("#tooltips-meta").html(s.opts.xlabel+": "+a+"<br/>"+s.opts.ylabel+": "+r)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),s.tooltips.transition().duration(300).style("opacity",0),s.tooltips.style("display","none")})}},t},n.chart.nmr=function(){var t=a();return t.render=function(t){var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var e=this;return this.scales={x:d3.scale.linear().domain([1,0]).range([0,this.width]),y:d3.scale.linear().range([this.height,0])},this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]),r(e),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title),"function"==typeof this.behavior&&this.behavior(),this},t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2)},t.mouseDown=function(t){var s=d3.mouse(t),e=this.opts.margins[3];this.panel.select(".st-selection").attr("x",s[0]-e).attr("xs",s[0]-e).attr("width",1).attr("height",this.height).attr("display","inline")},t.mouseMove=function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var e=d3.mouse(t)[0]-this.opts.margins[3],i=parseInt(s.attr("width"),10),a=e-parseInt(s.attr("x"),10),r=parseInt(s.attr("xs"),10);1>a&&i>2*a?(s.attr("x",e),s.attr("width",r-e)):s.attr("width",a)}},t.mouseUp=function(){var t=5,s=this.panel.select(".st-selection");if(parseInt(s.attr("width"))>t){var e=parseFloat(s.attr("x")),i=parseFloat(s.attr("width"));i=this.scales.x.invert(e+i),e=this.scales.x.invert(e),this.scales.x.domain([e,i]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),"function"==typeof this.renderdata&&null!==this.data&&this.renderdata()}else s.attr("display","none")},t.mouseDbl=function(){return null===this.data?(this.scales.x.domain([1,0]).nice(),this.scales.y.domain([0,1]).nice(),void this.canvas.select(".st-xaxis").call(this.xaxis)):(this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice(),this.scales.y.domain(this.data.raw.gylim),this.canvas.select(".st-xaxis").call(this.xaxis),void("function"==typeof this.renderdata&&(this.data.reset(),this.renderdata())))
},t.load=function(t){var s=this;this.data=t;var e=t.add;t.add=function(){e.apply(this,arguments),s.data.push(function(){s.xscale(),s.yscale(),r(s),s.canvas.select(".st-xaxis").call(s.xaxis),s.renderdata(),s.opts.legend&&s.renderLegend()})};var i=t.remove;t.remove=function(){var t=i.apply(this,arguments);for(var e in t)s.colors.remove(t[e]),s.canvas.selectAll("."+t[e]).remove();s.opts.legend&&s.renderLegend()}},t.renderdata=function(){for(var t=this.data.bin(this.width,this.scales.x),s=this,e=0;e<t.length;e++){var i=t[e],a=this.data.id(e),r=this.data.accs(e),n=d3.svg.line().x(function(t){return s.scales.x(t[r[0]])}).y(function(t){return s.scales.y(t[r[1]])});this.canvas.selectAll("."+a).remove();var o=this.canvas.append("g").attr("class",a);o.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(a)).attr("d",n(i))}},t},n.chart.nmr2d=function(){var t=a();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain([this.data.raw.gylim[1],this.data.raw.gylim[0]]).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.scales.y.domain([1,0]);var t=this.canvas.append("svg:rect").attr("class","st-selection").attr("y",0).attr("width",1).attr("height",this.height).style("pointer-events","none").attr("visibility","hidden"),s=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("width",this.width).attr("height",1).style("pointer-events","none").attr("visibility","hidden"),e=this;d3.select(".st-base").on("mousemove",function(){var i=d3.mouse(this)[0]-e.opts.margins[3],a=d3.mouse(this)[1]-e.opts.margins[0];0>i||i>e.width||0>a||a>e.height?(t.attr("visibility","hidden"),s.attr("visibility","hidden")):(t.attr("x",i),s.attr("y",a),t.attr("visibility","visible"),s.attr("visibility","visible"))}).append("svg:rect").attr("class","st-mouse-capture").style("visibility","hidden").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".3g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).tickSize(-this.height).tickPadding(5).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(6).tickFormat(s).tickSize(-this.width).tickPadding(5).orient("right"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate("+this.width+",0)").call(this.yaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",t[1]/2)},t.renderdata=function(){for(var t=this.data.get(this.width,this.scales.x),s=this,e=0;e<t.length;e++){var i=t[e],a=this.data.id(e),r=this.data.accs(e);this.canvas.selectAll("."+a).remove();var n=this.canvas.append("g").attr("class",a);n.selectAll("."+a+".circle").data(i).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(a)).style("stroke",this.colors.get(a)).attr("r",3).attr("cx",function(t){return s.scales.x(t[r[0]])}).attr("cy",function(t){return s.scales.y(t[r[1]])})}},t},"function"==typeof define&&define.amd?define(n):"object"==typeof module&&module.exports?module.exports=n:this.st=n}();