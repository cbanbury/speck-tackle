!function(){function t(){return{opts:{title:"",src:[],x:"",y:"",xlimits:[],ylimits:[]},raw:{gxlim:[Number.MAX_VALUE,Number.MIN_VALUE],gylim:[Number.MAX_VALUE,Number.MIN_VALUE],ids:{},series:[]},url:function(t){return t instanceof Array?this.opts.src.push.apply(this.opts.src,t):this.opts.src.push(t),this},id:function(t){return this.raw.series[t].id},accs:function(t){return this.raw.series[t].accs},push:function(t){var s=this,i=[];for(var e in this.opts.src)"string"!=typeof this.opts.src[e]?this.fetch(this.opts.src[e]):i.push(this.fetch(this.opts.src[e]));$.when.apply($,i).done(function(){s.opts.src=[],t()})},reset:function(){for(var t in this.raw.series){var s=this.raw.series[t];s.size=[0,s.data.length,0]}}}}function s(t,s,i,e){var a=[];return a=2===i.length?isNaN(i[0])&&isNaN(i[1])?[s[i[0]],s[i[1]]]:"number"==typeof i[0]&&"number"==typeof i[1]?[i[0],i[1]]:d3.extent(t,function(t){return t[e]}):d3.extent(t,function(t){return t[e]})}function i(t,i){var e=r.util.hashcode((new Date).getTime()*Math.random()+"");e="st"+e;var a=t[i.opts.title],n=[],l=[],o=[],h=i.opts.x,c=i.opts.y;if(a&&0!==a.length||(a=e),e in i.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+e);var d="";-1!==h.lastIndexOf(".")&&(d=h.substr(0,h.lastIndexOf(".")),h=h.substr(h.lastIndexOf(".")+1),c=c.substr(c.lastIndexOf(".")+1));var p=""===d?t:t[d];n=s(p,t,i.opts.xlimits,h),l=s(p,t,i.opts.ylimits,c),o=[0,p.length,0],n[0]<i.raw.gxlim[0]&&(i.raw.gxlim[0]=n[0]),l[0]<i.raw.gylim[0]&&(i.raw.gylim[0]=l[0]),n[1]>i.raw.gxlim[1]&&(i.raw.gxlim[1]=n[1]),l[1]>i.raw.gylim[1]&&(i.raw.gylim[1]=l[1]),i.raw.ids[e]=!0,i.raw.series.push({id:e,title:a,xlim:n,ylim:l,accs:[h,c],size:o,data:p,x:function(t){return this.data[t][this.accs[0]]},y:function(t){return this.data[t][this.accs[1]]}})}function e(t,i){var e=r.util.hashcode((new Date).getTime()*Math.random()+"");e="st"+e;var a=t[i.opts.title],n=[],l=[],o=[],h="x",c=i.opts.y;if(a&&0!==a.length||(a=e),e in i.raw.ids)return void console.log("SpeckTackle: Non unique identifier: "+e);var d=""===c?t:t[c];n=s(d,t,i.opts.xlimits,h),l=s(d,t,i.opts.ylimits,c),o=[0,d.length,0],n[0]<i.raw.gxlim[0]&&(i.raw.gxlim[0]=n[0]),l[0]<i.raw.gylim[0]&&(i.raw.gylim[0]=l[0]),n[1]>i.raw.gxlim[1]&&(i.raw.gxlim[1]=n[1]),l[1]>i.raw.gylim[1]&&(i.raw.gylim[1]=l[1]),i.raw.ids[e]=!0,i.raw.series.push({id:e,title:a,xlim:n,ylim:l,accs:[h,c],size:o,data:d,x:function(t){return t},y:function(t){return this.data[t][this.accs[1]]}})}function a(){return{opts:{title:"",xlabel:"",ylabel:"",legend:!1,margins:[80,80,80,120]},data:null,colors:r.util.colors(),title:function(t){return this.opts.title=t,this},xlabel:function(t){return this.opts.xlabel=t,this},ylabel:function(t){return this.opts.ylabel=t,this},legend:function(t){return this.opts.legend=t,this},margins:function(t){return this.opts.margins=t,this},render:function(t){this.target=t;var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var i=this;this.canvas=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]).on("mousedown.zoom",function(){i.mouseDown(this)}).on("mousemove.zoom",function(){i.mouseMove(this)}).on("mouseup.zoom",function(){i.mouseUp()}).on("dblclick.zoom",function(){i.mouseDbl()}).append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.scales={x:d3.scale.linear().range([0,this.width]),y:d3.scale.linear().range([this.height,0])},this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&d3.select(".st-base").append("text").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title),"function"==typeof this.behavior&&this.behavior()},renderAxes:function(){var t=this.opts.margins,s=d3.format(".4g"),i=d3.format(",.2g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(4).tickFormat(i).orient("left"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate(-25, 0)").call(this.yaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",0-t[3]/2)},mouseDown:function(t){var s=d3.mouse(t),i=this.opts.margins[3],e=this.opts.margins[0];d3.select(".st-selection").attr("x",s[0]-i).attr("xs",s[0]-i).attr("y",s[1]-e).attr("ys",s[1]-e).attr("width",1).attr("height",1).attr("display","inline")},mouseMove:function(t){var s=d3.select(".st-selection");if("inline"===s.attr("display")){var i=d3.mouse(t)[0]-this.opts.margins[3],e=d3.mouse(t)[1]-this.opts.margins[0],a=parseInt(s.attr("width"),10),r=parseInt(s.attr("height"),10),n=i-parseInt(s.attr("x"),10),l=e-parseInt(s.attr("y"),10),o=parseInt(s.attr("xs"),10),h=parseInt(s.attr("ys"),10);0>n&&0>l||a>2*n&&r>2*l?(s.attr("x",i),s.attr("width",o-i),s.attr("y",e),s.attr("height",h-e)):0>n||a>2*n?(s.attr("x",i),s.attr("width",o-i),s.attr("height",l)):0>l||r>2*l?(s.attr("y",e),s.attr("height",h-e),s.attr("width",n)):(s.attr("width",n),s.attr("height",l))}},mouseUp:function(){var t=5,s=d3.select(".st-selection");if(parseInt(s.attr("width"))>t&&parseInt(s.attr("height"))>t){var i=parseFloat(s.attr("x")),e=parseFloat(s.attr("y")),a=parseFloat(s.attr("width")),r=parseFloat(s.attr("height"));a=this.scales.x.invert(i+a),r=this.scales.y.invert(e+r),i=this.scales.x.invert(i),e=this.scales.y.invert(e),0>r&&(r=0),this.scales.x.domain([i,a]).nice(),this.scales.y.domain([r,e]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata&&this.renderdata()}else s.attr("display","none")},mouseDbl:function(){var t=r.util.domain(this.scales.x,this.data.raw.gxlim),s=r.util.domain(this.scales.y,this.data.raw.gylim);this.scales.x.domain(t).nice(),this.scales.y.domain(s).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),"function"==typeof this.renderdata&&(this.data.reset(),this.renderdata())},renderLegend:function(){for(var t=this.canvas.append("g").attr("class","st-legend").style("cursor","pointer"),s=this.colors,i=this,e=0;e<this.data.raw.series.length;e++){var a=this.data.raw.series[e].id,r=this.data.raw.series[e].title,n=t.append("g").attr("stid",a);n.append("svg:rect").attr("x",this.width+5).attr("y",function(){return 20*e}).attr("width",10).attr("height",10).style("fill",function(){return s.get(e)}),n.append("text").attr("x",this.width+20).attr("y",function(){return 20*e+9}).text(function(){var t=r;return t}),n.on("mouseover",function(){d3.select(this).style("fill","red");var t=d3.select(this).attr("stid");i.canvas.selectAll("."+t).style("stroke-width",2);for(var s in i.data.raw.ids)s!==t&&i.canvas.selectAll("."+s).style("opacity",.1)}),n.on("mouseout",function(){d3.select(this).style("fill","black");var t=d3.select(this).attr("stid");i.canvas.selectAll("."+t).style("stroke-width",1);for(var s in i.data.raw.ids)s!==t&&i.canvas.selectAll("."+s).style("opacity",1)})}},load:function(t){this.data=t;var s=this;this.data.push(function(){s.xscale(),s.yscale(),s.canvas.select(".st-xaxis").call(s.xaxis),s.canvas.select(".st-yaxis").call(s.yaxis),s.renderdata(),s.opts.legend&&s.renderLegend()})}}}var r={version:"0.0.1"};r.util={},r.util.cache=function(){var t={},s=[],i=function(t){return"[object Object]"===t.toString()?$.param(t):t.toString()},e=function(i,e){-1===s.indexOf(i)&&s.push(i),t[i]=e},a=function(s){return t.hasOwnProperty(s)},r=function(s){var i;return void 0!==t[s]&&(i="[object Object]"===t[s].toString()?$.extend(!0,{},t[s]):t[s]),i},n=function(t){return i(t)};return{add:e,get:r,getKey:n,exists:a}},r.util.colors=function(){var t={0:"red",1:"blue",2:"green",3:"orange",4:"yellow",5:"black"},s=0,i={},e=function(t){return i[t]?i[t]:(i[t]=a(),i[t])},a=function(){return s===Object.keys(t).length&&(s=0),t[s++]};return{get:e}},r.util.hashcode=function(t){var s,i,e,a=0;if(0==t.length)return a;for(s=0,e=t.length;e>s;s++)i=t.charCodeAt(s),a=(a<<5)-a+i,a|=0;return a},r.util.domain=function(t,s){var i=t.domain();return i[0]>i[1]?[s[1],s[0]]:[s[0],s[1]]},r.util.mol2svg=function(t,s){var i=t||200,e=s||200,a=null,n=null,l=0,o=r.util.cache(),h=function(t,s){$(s).empty();var i=d3.select(s),e=o.getKey(t);if(o.exists(e)){var a=o.get(e);c(a,i)}else d3.text(t,"text/plain",function(t,s){t?console.log("Invalid molfile url error "+t):(o.add(e,s),c(s,i))})},c=function(t,s){var i=t.split(/\r\n|\n/),e=i[3].match(/\d+/g),a=parseFloat(e[0]),r=parseFloat(e[1]),n=d(i,a),o=p(i,a,r);u(i,n,a+r);var h=f(n,s);v(n,o,h),x(n,l,h)},d=function(t,s){for(var i=[],e=4,a=e;s+e>a;a++){var r=t[a].match(/-*\d+\.\d+|\w+/g);i.push({x:parseFloat(r[0]),y:parseFloat(r[1]),symbol:r[3],mass:0,charge:0})}return i},p=function(t,s,i){for(var e=[],a=4,r=s+a;s+i+a>r;r++){var n=t[r].match(/\d+/g);e.push({a1:parseInt(n[0])-1,a2:parseInt(n[1])-1,order:parseInt(n[2]),stereo:parseInt(n[3])})}return e},u=function(t,s,i){for(var e=4,a=i+e;a<t.length;a++)if(-1!==t[a].indexOf("M  ISO"))for(var r=t[a].match(/-*\d+/g),n=0,l=1;n<r[0];n++,l+=2)s[r[l]-1].mass=parseInt(r[l+1],10);else if(-1!==t[a].indexOf("M  CHG"))for(var r=t[a].match(/-*\d+/g),n=0,l=1;n<r[0];n++,l+=2)s[r[l]-1].charge=parseInt(r[l+1],10)},f=function(t,s){var r=d3.extent(t,function(t){return t.x}),l=d3.extent(t,function(t){return t.y}),o=[10,10,10,10],h=i-o[1]-o[3],c=e-o[0]-o[2],d=(r[1]-r[0])/(l[1]-l[0]);d>1?c/=d:h*=d,a=d3.scale.linear().domain([r[0],r[1]]).range([0,h]),n=d3.scale.linear().domain([l[0],l[1]]).range([c,0]);var p=s.append("svg:svg").attr("width",h+o[1]+o[3]).attr("height",c+o[0]+o[2]).append("svg:g").attr("transform","translate("+o[3]+","+o[0]+")");return p},v=function(t,s,i){for(var e=0;e<s.length;e++){var r=t[s[e].a1],o=t[s[e].a2],h=o.x-r.x,c=o.y-r.y,d=Math.sqrt(h*h+c*c),p=h/d*.2,u=c/d*.2,f=r.x+p,v=r.y+u,x=o.x-p,k=o.y-u;l+=g(a(f),n(v),a(x),n(k));var A,z,F,M=[];if(1===s[e].order)if(1===s[e].stereo){var I=g(f,v,x,k);A=.1,z=A*(k-v)/I,F=A*(f-x)/I,M=[[f,v],[x+z,k+F],[x-z,k-F]],i.append("svg:path").attr("d",m(M))}else if(6===s[e].stereo){A=.2,z=A*(k-v)/d,F=A*(f-x)/d;for(var N=x+z-f,S=k+F-v,D=x-z-f,O=k-F-v,$=.05;1>=$;$+=.15)M.push([f+N*$,v+S*$],[f+D*$,v+O*$]);i.append("svg:path").attr("d",w(M)).attr("stroke","black")}else if(4===s[e].stereo){A=.2,z=A*(k-v)/d,F=A*(f-x)/d;for(var N=x+z-f,S=k+F-v,D=x-z-f,O=k-F-v,$=.05;1>=$;$+=.1)M.push(M.length%2===0?[f+N*$,v+S*$]:[f+D*$,v+O*$]);i.append("svg:path").attr("d",b(M)).attr("fill","none").attr("stroke","black")}else M=[[f,v],[x,k]],i.append("svg:path").attr("d",y(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black");else 2===s[e].order?(A=.1,z=A*(k-v)/d,F=A*(f-x)/d,M=[[f+z,v+F],[x+z,k+F],[f-z,v-F],[x-z,k-F]],i.append("svg:path").attr("d",y(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")):3===s[e].order&&(A=.15,z=A*(k-v)/d,F=A*(f-x)/d,M=[[f,v],[x,k],[f+z,v+F],[x+z,k+F],[f-z,v-F],[x-z,k-F]],i.append("svg:path").attr("d",y(M)).attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black"))}l/=s.length},x=function(t,s,i){for(var e=0;e<t.length;e++){var r=t[e],l=d3.rgb(k[r.symbol]),o=i.append("svg:g").attr("transform","translate("+a(r.x)+","+n(r.y)+")");if(o.append("svg:circle").attr("r",Math.ceil(s/3)).attr("fill","white").attr("opacity","1"),o.append("text").attr("dy",Math.ceil(s/4.5)).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/1.5)).attr("fill",l).text(r.symbol),0!==r.charge){var h=r.charge;h=0>h?-1===h?"-":h+"-":1===h?"+":h+"+",o.append("text").attr("dx",1*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("fill",l).attr("font-size",Math.ceil(s/3)).text(h)}0!==r.mass&&o.append("text").attr("dx",-2*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/3)).attr("fill",l).text(r.mass)}},g=function(t,s,i,e){return Math.sqrt((i-t)*(i-t)+(e-s)*(e-s))},y=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],i=1;i<t.length;i++)s+=i%2===0?"M"+t[i][0]+","+t[i][1]:"L"+t[i][0]+","+t[i][1];return s}).x(function(t){return a(t[0])}).y(function(t){return n(t[1])}),m=d3.svg.line().x(function(t){return a(t[0])}).y(function(t){return n(t[1])}),w=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],i=1;i<t.length;i++)s+=i%2===0?"M"+t[i][0]+","+t[i][1]:"L"+t[i][0]+","+t[i][1];return s}).x(function(t){return a(t[0])}).y(function(t){return n(t[1])}),b=d3.svg.line().interpolate("cardinal").x(function(t){return a(t[0])}).y(function(t){return n(t[1])}),k={H:"#000000",He:"#FFC0CB",Li:"#B22222",B:"#00FF00",C:"#000000",N:"#8F8FFF",O:"#F00000",F:"#DAA520",Na:"#0000FF",Mg:"#228B22",Al:"#808090",Si:"#DAA520",P:"#FFA500",S:"#FFC832",Cl:"#00FF00",Ca:"#808090",Ti:"#808090",Cr:"#808090",Mn:"#808090",Fe:"#FFA500",Ni:"#A52A2A",Cu:"#A52A2A",Zn:"#A52A2A",Br:"#A52A2A",Ag:"#808090",I:"#A020F0",Ba:"#FFA500",Au:"#DAA520"};return{draw:h}},r.util.spinner=function(t){return $(".st-spinner").length?(console.log("SDF"),$(".st-spinner")):($(t).append('<div class="st-spinner"><div class="st-bounce1"></div><div class="st-bounce2"></div><div class="st-bounce3"></div></div>'),$(".st-spinner"))},r.data={},r.data.set=function(){var s=t();return s.title=function(t){return this.opts.title=t,this},s.x=function(t){return this.opts.x=t,this},s.y=function(t){return this.opts.y=t,this},s.xlimits=function(t){return s.opts.xlimits=t,this},s.ylimits=function(t){return s.opts.ylimits=t,this},s.fetch=function(t){var s=this,e=null;if("string"==typeof t)e=$.getJSON(t,function(t){if(t instanceof Array)for(var e in t)i(t[e],s);else i(t,s)});else if(t instanceof Array)for(var a in t)i(t[a],s);else i(t,s);return e},s.get=function(t,s){var i=[],e=[s.invert(0),s.invert(t)];e=r.util.domain(s,e);for(var a in this.raw.series){var n=this.raw.series[a],l=[];for(var o in n.data){var h=n.x(o);h>=e[0]&&h<=e[1]&&l.push(n.data[o])}i.push(l)}return i},s.bin=function(t,s){var i=[],e=[s.invert(0),s.invert(t)];e=r.util.domain(s,e);var a=1;for(var n in this.raw.series){var l=this.raw.series[n],o=l.data.length,h=l.size;0===h[2]&&(h[2]=Math.ceil(t/a));for(var c=Math.abs(e[1]-e[0])/(h[2]-1),d=[],p=0;l.size[0]>0;){var u=l.x(l.size[0]);if(u<e[0])break;l.size[0]-=1}for(;l.size[1]<o;){var u=l.x(l.size[1]);if(u>e[1])break;l.size[1]+=1}for(var f=l.size[0];f<l.size[1];f++){var u=l.x(f);if(u<e[0])h[0]=f;else{if(u>e[1]){h[1]=f;break}var v=Math.floor((u-e[0])/c),x=d[v],g=l.data[f];x?d[v-p]=x[l.accs[1]]>g[l.accs[1]]?x:g:(p=v-d.length,d[v-p]=g)}}p>0&&(h[2]=d.length),l.size=h,i.push(d)}return i},s},r.data.array=function(){var s=t();return s.title=function(t){return this.opts.title=t,this},s.y=function(t){return this.opts.y=t,this},s.xlimits=function(t){return this.opts.xlimits=t,this},s.ylimits=function(t){return this.opts.ylimits=t,this},s.fetch=function(t){var s=this,i=null;return"string"==typeof t?i=$.getJSON(t,function(t){e(t,s)}):e(t,s),i},s.get=function(t,s){var i=[],e=[s.invert(0),s.invert(t)];e=r.util.domain(s,e);for(var a in this.raw.series){for(var n=this.raw.series[a],l=n.data.length,o=(n.xlim[1]-n.xlim[0])/l,h=n.size,c=[];n.size[0]>0;){var d=n.size[0]*o+n.xlim[0];if(d<e[0])break;n.size[0]-=1}for(;n.size[1]<l;){var d=n.size[1]*o+n.xlim[0];if(d>e[1])break;n.size[1]+=1}for(var p=n.size[0];p<n.size[1];p++){var d=p*o+n.xlim[0];if(d<e[0])h[0]=p;else{if(d>e[1]){h[1]=p;break}var u=n.data[p],f={x:d};f[n.accs[1]]=u,c.push(f)}}n.size=h,i.push(c)}return i},s.bin=function(t,s){var i=[],e=[s.invert(0),s.invert(t)];e=r.util.domain(s,e);var a=1;for(var n in this.raw.series){var l=this.raw.series[n],o=l.data.length,h=(l.xlim[1]-l.xlim[0])/o,c=l.size;0===c[2]&&(c[2]=Math.ceil(t/a));for(var d=Math.abs(e[1]-e[0])/(c[2]-1),p=[],u=0;l.size[0]>0;){var f=l.size[0]*h+l.xlim[0];if(f<e[0])break;l.size[0]-=1}for(;l.size[1]<o;){var f=l.size[1]*h+l.xlim[0];if(f>e[1])break;l.size[1]+=1}for(var v=l.size[0];v<l.size[1];v++){var f=v*h+l.xlim[0];if(f<e[0])c[0]=v;else{if(f>e[1]){c[1]=v;break}var x=Math.floor((f-e[0])/d),g=p[x],y=l.data[v];g?g[l.accs[1]]>y?p[x-u]=g:(p[x-u]={x:f},p[x-u][l.accs[1]]=y):(u=x-p.length,p[x-u]={x:f},p[x-u][l.accs[1]]=y)}}u>0&&(c[2]=p.length),l.size=c,i.push(p)}return i},s},r.chart={},r.chart.series=function(){var t=a();return t.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.tooltips=d3.select("body").append("div").attr("id","tooltips").attr("class","st-tooltips").style("position","absolute").style("z-index","10").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")},t.renderdata=function(){for(var t=this.data.bin(this.width,this.scales.x),s=this,i=d3.format(".2f"),e=0;e<t.length;e++){var a=t[e],r=this.data.id(e),n=this.data.accs(e),l=d3.svg.line().interpolate("cardinal-open").x(function(t){return s.scales.x(t[n[0]])}).y(function(t){return s.scales.y(t[n[1]])});this.canvas.selectAll("."+r).remove();var o=this.canvas.append("g").attr("class",r);o.append("svg:path").attr("clip-path","url(#clip)").style("stroke",this.colors.get(e)).attr("d",l(a)),o.selectAll("."+r+".circle").data(a).enter().append("svg:circle").attr("clip-path","url(#clip)").style("fill",this.colors.get(e)).style("stroke",this.colors.get(e)).attr("r",2).attr("cx",function(t){return s.scales.x(t[n[0]])}).attr("cy",function(t){return s.scales.y(t[n[1]])}).on("mouseover",function(t){d3.select(this).attr("r",4),s.tooltips.style("display","inline"),s.tooltips.transition().duration(300).style("opacity",.9),s.tooltips.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("background-color","white");var e=i(t[n[0]]),a=i(t[n[1]]);d3.selectAll("#tooltips-meta").html(s.opts.xlabel+": "+e+"<br/>"+s.opts.ylabel+": "+a)}).on("mouseout",function(){d3.select(this).attr("r","2"),s.tooltips.transition().duration(300).style("opacity",0),s.tooltips.style("display","none")})}},t},r.chart.ms=function(){var t=a();return t.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.tooltips=d3.select(this.target).append("div").attr("id","tooltips").attr("class","st-tooltips").style("position","absolute").style("z-index","10").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")},t.mol2svg=r.util.mol2svg(200,200),t.renderdata=function(){for(var t,s=this.data.bin(this.width,this.scales.x),i=this,e=d3.format(".2f"),a=0;a<s.length;a++){var n=s[a],l=this.data.id(a),o=this.data.accs(a);this.canvas.selectAll("."+l).remove();var h=this.canvas.append("g").attr("class",l);h.selectAll("."+l+".line").data(n).enter().append("svg:line").attr("clip-path","url(#clip)").attr("x1",function(t){return i.scales.x(t[o[0]])}).attr("y1",function(t){return i.scales.y(t[o[1]])}).attr("x2",function(t){return i.scales.x(t[o[0]])}).attr("y2",this.height).style("stroke",this.colors.get(a)).on("mouseover",function(s){d3.select(this).style("stroke-width",2),i.tooltips.style("display","inline"),i.tooltips.transition().duration(300).style("opacity",.9),i.tooltips.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("background-color","white");var a=e(s[o[0]]),n=e(s[o[1]]);if(d3.selectAll("#tooltips-meta").html(i.opts.xlabel+": "+a+"<br/>"+i.opts.ylabel+": "+n),s.ref){var l=r.util.spinner("#tooltips-mol");t=setTimeout(function(){l.css("display","none"),i.mol2svg.draw("http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/174174/SDF","#tooltips-mol")},500)}else d3.selectAll("#tooltips-mol").html("")}).on("mouseout",function(){clearTimeout(t),d3.selectAll("#tooltips-mol").html(""),d3.select(this).style("stroke-width","1"),i.tooltips.transition().duration(300).style("opacity",0),i.tooltips.style("display","none")})}},t},r.chart.nmr=function(){var t=a();return t.render=function(t){var s=this.opts.margins;this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2];var i=this;return this.scales={x:d3.scale.linear().range([0,this.width]),y:d3.scale.linear().range([this.height,0])},this.mousewheel=d3.behavior.zoom().y(this.scales.y).center([0,this.scales.y(0)]).on("zoom",function(){i.renderdata()}),this.canvas=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]).call(this.mousewheel).on("mousedown.zoom",function(){i.mouseDown(this)}).on("mousemove.zoom",function(){i.mouseMove(this)}).on("mouseup.zoom",function(){i.mouseUp(this)}).on("dblclick.zoom",function(){i.mouseDbl()}).append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&d3.select(".st-base").append("text").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title),"function"==typeof this.behavior&&this.behavior(),this},t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2)},t.mouseDown=function(t){var s=d3.mouse(t),i=this.opts.margins[3];d3.select(".st-selection").attr("x",s[0]-i).attr("xs",s[0]-i).attr("width",1).attr("height",this.height).attr("display","inline")},t.mouseMove=function(t){var s=d3.select(".st-selection");if("inline"===s.attr("display")){var i=d3.mouse(t)[0]-this.opts.margins[3],e=parseInt(s.attr("width"),10),a=i-parseInt(s.attr("x"),10),r=parseInt(s.attr("xs"),10);1>a&&e>2*a?(s.attr("x",i),s.attr("width",r-i)):s.attr("width",a)}},t.mouseUp=function(){var t=5,s=d3.select(".st-selection");if(parseInt(s.attr("width"))>t){var i=parseFloat(s.attr("x")),e=parseFloat(s.attr("width"));e=this.scales.x.invert(i+e),i=this.scales.x.invert(i),this.scales.x.domain([i,e]).nice(),s.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),"function"==typeof this.renderdata&&this.renderdata()}else s.attr("display","none")},t.mouseDbl=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice(),this.scales.y.domain(this.data.raw.gylim).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),"function"==typeof this.renderdata&&(this.data.reset(),this.renderdata())},t.load=function(t){this.data=t;var s=this;this.data.push(function(){s.xscale(),s.yscale(),s.mousewheel.y(s.scales.y).center([0,s.scales.y(0)]),s.canvas.select(".st-xaxis").call(s.xaxis),s.renderdata(),s.opts.legend&&s.renderLegend()})},t.renderdata=function(){for(var t=this.data.bin(this.width,this.scales.x),s=this,i=0;i<t.length;i++){var e=t[i],a=this.data.id(i),r=this.data.accs(i),n=d3.svg.line().x(function(t){return s.scales.x(t[r[0]])}).y(function(t){return s.scales.y(t[r[1]])});this.canvas.selectAll("."+a).remove();var l=this.canvas.append("g").attr("class",a);l.append("svg:path").attr("clip-path","url(#clip)").style("stroke",this.colors.get(i)).attr("d",n(e))}},t},r.chart.nmr2d=function(){var t=a();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain([this.data.raw.gylim[1],this.data.raw.gylim[0]]).nice()},t.behavior=function(){var t=this.canvas.append("svg:rect").attr("class","st-selection").attr("y",0).attr("width",1).attr("height",this.height).style("pointer-events","none").attr("visibility","hidden"),s=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("width",this.width).attr("height",1).style("pointer-events","none").attr("visibility","hidden"),i=this;d3.select(".st-base").on("mousemove",function(){var e=d3.mouse(this)[0]-i.opts.margins[3],a=d3.mouse(this)[1]-i.opts.margins[0];0>e||e>i.width||0>a||a>i.height?(t.attr("visibility","hidden"),s.attr("visibility","hidden")):(t.attr("x",e),s.attr("y",a),t.attr("visibility","visible"),s.attr("visibility","visible"))}).append("svg:rect").attr("class","st-mouse-capture").style("visibility","hidden").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".3g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).tickSize(-this.height).tickPadding(5).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(6).tickFormat(s).tickSize(-this.width).tickPadding(5).orient("right"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate("+this.width+",0)").call(this.yaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",t[1]/2)},t.renderdata=function(){for(var t=this.data.get(this.width,this.scales.x),s=this,i=0;i<t.length;i++){var e=t[i],a=this.data.id(i),r=this.data.accs(i);this.canvas.selectAll("."+a).remove();var n=this.canvas.append("g").attr("class",a);n.selectAll("."+a+".circle").data(e).enter().append("svg:circle").attr("clip-path","url(#clip)").style("fill",this.colors.get(i)).style("stroke",this.colors.get(i)).attr("r",3).attr("cx",function(t){return s.scales.x(t[r[0]])}).attr("cy",function(t){return s.scales.y(t[r[1]])})}},t},"function"==typeof define&&define.amd?define(r):"object"==typeof module&&module.exports?module.exports=r:this.st=r}();