<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>SpeckTackle Development</title>
    <meta charset="UTF-8">
    
    <!-- Main page CSS -->
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <!-- SpeckTackle CSS containing chart stylings -->
    <link rel="stylesheet" type="text/css" href="css/st.css">
    
    <!-- SpeckTackle library -->
    <script type="text/javascript", src="st.js"></script>
    <!-- SpeckTackle dependencies -->
    <script type="text/javascript", src="libs/d3/d3.js"></script>
    <script type="text/javascript", src="libs/jquery/jquery.js"></script>

    <script type="text/javascript">
        // demonstration of SpeckTackle charts
        var chart;
        function ms () {                        // MS stub
            $("#stgraph").empty();              // clear DOM child elements
            $("#adddata").removeAttr("disabled")// enable 'Add Data' button
                .attr("onclick","load(0)");     // point to data loader
            chart = st.chart                    // create a new MS chart
                .ms()                           // chart type
                .legend(true)                   // options
                .xlabel("m/z")
                .ylabel("Abundance")
                .margins([80, 80, 80, 120]);
            chart.render("#stgraph");           // render chart to id 'stgraph'
        };
        function nmr () {                       // NMR stub
            $("#stgraph").empty();
            $("#adddata").removeAttr("disabled")
                .attr("onclick","load(1)");
            chart = st.chart
                .nmr()
                .legend(true)
                .title("NMR")
                .xlabel("ppm")
                .margins([80, 80, 80, 80]);
            chart.render("#stgraph");
        };
        function nmr2d () {                     // NMR 2D stub
            $("#stgraph").empty();
            $("#adddata").removeAttr("disabled")
                .attr("onclick","load(2)");
            chart = st.chart
                .nmr2d()
                .xlabel("Chemical Shift (ppm)")
                .ylabel("Chemical Shift (ppm)")
                .margins([80, 120, 80, 80]);
            chart.render("#stgraph");
        };
        function series () {                    // Chromatogram stub
            $("#stgraph").empty();
            $("#adddata").removeAttr("disabled")
                .attr("onclick","load(3)");
            chart = st.chart
                .series()
                .legend(true)
                .xlabel("Time [s]")
                .ylabel("Abundance")
                .title("Chromatogram")
                .margins([80, 80, 80, 120]);
            chart.render("#stgraph");
        };
        function irjdx () {                     // IR (JDX) stub
            $("#stgraph").empty();
            $("#adddata").removeAttr("disabled")
                .attr("onclick","load(4)");
            chart = st.chart
                .ir()
                .legend(true)
                .xlabel("1/cm")
                .ylabel("Transmittance")
                .title("Infrared Spectrum")
                .margins([80, 120, 80, 120]);
            chart.render("#stgraph");
        };
        function uvvisjdx () {                 // UV/VIS (JDX) stub
            $("#stgraph").empty();
            $("#adddata").removeAttr("disabled")
                .attr("onclick","load(5)");
            chart = st.chart
                .series()
                .legend(true)
                .xlabel("Wavelength [nm]")
                .ylabel("Absorbance")
                .title("UV/VIS Spectrum")
                .margins([80, 120, 80, 120]);
            chart.render("#stgraph");
        };
        function load (x) {                         // load chart data
            switch (x) {
                case 0:                             // MS
                    var set = st.data.set()         // data type (set)
                        .ylimits([0, 1000])       // y-axis limits
                        .x("peaks.mz")
                        .y("peaks.intensity")
                        //.ylimits([0, 10000])         // y-axis limits
                        //.x("data.x")
                        //.y("data.y")
                        .title("spectrumId");
                    chart.load(set);                // load the data
                    set.add([                      // input array
                        "resources/data1.json",
                        "resources/data2.json",
                        "resources/data3.json"
                        //"resources/multiple.json"
                        //"http://www.ebi.ac.uk/metabolights/spectra/15769/json"
                    ]);
                    break;
                case 1:                             // NMR
                    var array = st.data.array()     // data type (array)
                        .xlimits(["xMin", "xMax"])
                        .ylimits(["yMin", "yMax"])
                        .y("data")                  // array is one dimensional
                        .title("id");
                    chart.load(array);   
                    array.add([
                        "resources/nmr1.json",
                        "resources/nmr2.json"
                    ]);
                    break;  
                case 2:                             // NMR 2D
                    var set = st.data.set()
                        .x("data.x")
                        .y("data.y");
                    chart.load(set);
                    set.add("resources/nmr2d.json");
                    break;
                case 3:                             // Chromatogram
                    var set = st.data.set()
                        .x("peaks.mz")
                        .y("peaks.intensity")
                        .title("spectrumId");
                    chart.load(set);
                    set.add([
                        "resources/data1.json",
                        "resources/data2.json",
                        "resources/data3.json"
                    ]);
                    break;
                case 4:                             // IR (JDX)
                    var array = st.data.array()
                        .xlimits(["FIRSTX", "LASTX"])
                        .ylimits(["MINY", "MAXY"])
                        .y("XYDATA")
                        .title("TITLE");
                    chart.load(array);
                    st.parser.jdx("resources/jtpolys.jdx", function (jdx) {
                        array.add(jdx);
                    });
                    break;
                case 5:                             // UV/VIS (JDX)
                    var array = st.data.array()
                        .xlimits(["LASTX", "FIRSTX"])
                        .ylimits(["MAXY", "MINY"])
                        .y("XYDATA")
                        .title("TITLE");
                    chart.load(array);
                    st.parser.jdx("resources/blckpac1.jdx", function (jdx) {
                        array.add(jdx);
                    });
                    break;
            };
            $("#adddata").attr('disabled','disabled');
        };
        function dynamicms () {                        // dynamic MS stub
            ms();
            $("#adddata").attr('disabled','disabled');
            var counter = 0;
            var data = [
                "resources/data1.json",
                "resources/data2.json",
                "resources/data3.json"
            ]
            var set = st.data.set()
                .ylimits([0, 1000])
                .x("peaks.mz")
                .y("peaks.intensity")
                .title("spectrumId");
            chart.load(set);
            setTimeout(function iter() {
                if (counter === 6) {
                    counter = 0;
                }
                if (counter < 3) {
                    $("#dynamicload").html("Loading: " + data[counter]);
                    set.add(data[counter]);
                } else {
                    $("#dynamicload").html("Removing: " + data[counter - 3]);
                    set.remove(0);
                }
                counter += 1;
                setTimeout(iter, 2000);
            }, 2000);
        };
        function dynamicnmr () {                // dynamic NMR stub
            nmr();
            $("#adddata").attr('disabled','disabled');
            var counter = 0;
            var data = [
                "resources/nmr1.json",
                "resources/nmr2.json"
            ];
            var array = st.data.array()     // data type (array)
                .xlimits(["xMin", "xMax"])
                .ylimits(["yMin", "yMax"])
                .y("data")                  // array is one dimensional
                .title("id");
            chart.load(array);
            setTimeout(function iter() {
                if (counter === 4) {
                    counter = 0;
                }
                if (counter < 2) {
                    $("#dynamicload").html("Loading: " + data[counter]);
                    array.add(data[counter]);
                } else {
                    $("#dynamicload").html("Removing: " + data[counter - 2]);
                    array.remove(0);
                }
                counter += 1;
                setTimeout(iter, 2000);
            }, 2000);
        };
        function multiplecharts () {
            $("#stgraph").css("display", "none");
            $("#stgraphm1").empty();
            $("#stgraphm2").empty();
            $("#stgraphm3").empty();
            var chart1 = st.chart
                .ms()
                .legend(true)
                .xlabel("m/z")
                .ylabel("Abundance")
                .title("Mass Spectrum")
                .margins([80, 80, 80, 120]);
            var chart2 = st.chart
                .series()
                .legend(true)
                .xlabel("Time [s]")
                .ylabel("Abundance")
                .title("Chromatogram")
                .margins([80, 80, 80, 120]);
            var chart3 = st.chart
                .nmr()
                .legend(true)
                .title("NMR")
                .xlabel("ppm")
                .margins([80, 80, 80, 80]);
            chart1.render("#stgraphm1");
            chart2.render("#stgraphm2");
            chart3.render("#stgraphm3");
            var set1 = st.data.set()
                .ylimits([0, 1000])
                .x("peaks.mz")
                .y("peaks.intensity")
                .title("spectrumId");
            var set2 = st.data.set()
                .ylimits([0, 1000])
                .x("peaks.mz")
                .y("peaks.intensity")
                .title("spectrumId");
            var set3 = st.data.set()
                .ylimits([0, 1000])
                .x("peaks.mz")
                .y("peaks.intensity")
                .title("spectrumId");
            chart1.load(set1);
            chart2.load(set2);
            chart3.load(set3);
            var data = [
                "resources/data1.json",
                "resources/data2.json",
                "resources/data3.json"
            ];
            set1.add(data);
            set2.add(data);
            set3.add(data);
        };
    </script>

</head>
<body>
    <div id="wrap">
        <h2>SpeckTackle</h2>
        <ul>
            <li><button onclick="ms()">MS</button></li>
            <li><button onclick="nmr()">NMR</button></li>
            <li><button onclick="nmr2d()">NMR2D</button></li>
            <li><button onclick="series()">Chromatogram</button></li>
            <li><button onclick="irjdx()">IR (JDX)</button></li>
            <li><button onclick="uvvisjdx()">UV/VIS (JDX)</button></li>
            <li>&nbsp;&rarr;&nbsp;</li>
            <li><button id="adddata" onclick="load()" 
                        disabled="disabled">Add Data</button></li>
        </ul>
        <hr>
        <ul>
            <li><button onclick="multiplecharts()">Multiple Charts (refresh)</button></li>
            <li><button onclick="dynamicms()">Dynamic MS</button></li>
            <li><button onclick="dynamicnmr()">Dynamic NMR</button></li>
            <li id="dynamicload"></li>
        </ul>
        <hr>
        <!-- Container for all charts: '#stgraph' -->
        <div id="stgraph" class="stgraph"></div>
        <div id="stgraphm1" class="stgraphm"></div>
        <div id="stgraphm2" class="stgraphm"></div>
        <div id="stgraphm3" class="stgraphm"></div>
    </div>
</body>
</html>